(function(P,st){typeof exports=="object"&&typeof module<"u"?st(exports,require("talib-web")):typeof define=="function"&&define.amd?define(["exports","talib-web"],st):(P=typeof globalThis<"u"?globalThis:P||self,st(P["TradeX-chart"]={},P.talib))})(this,function(P,st){"use strict";function He(s){if(s&&s.__esModule)return s;var t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});return s&&Object.keys(s).forEach(function(e){if(e!=="default"){var i=Object.getOwnPropertyDescriptor(s,e);Object.defineProperty(t,e,i.get?i:{enumerable:!0,get:function(){return s[e]}})}}),t.default=s,Object.freeze(t)}var Ft=He(st);const u={findByID(s){return document.getElementById(s)},findByClass(s){return document.getElementsByClassName(s)},findByName(s){return document.getElementsByName(s)},fndByTag(s){return document.getElementsByTagName(s)},findBySelector(s){return document.querySelector(s)},findBySelectorAll(s){return document.querySelectorAll(s)},isNode(s){return typeof Node=="object"?s instanceof Node:s&&typeof s=="object"&&typeof s.nodeType=="number"&&typeof s.nodeName=="string"},isElement(s){return typeof HTMLElement=="object"?s instanceof HTMLElement:s&&typeof s=="object"&&s!==null&&s.nodeType===1&&typeof s.nodeName=="string"},isVisible(s){return!!s&&!!(s.offsetWidth||s.offsetHeight||s.getClientRects().length)},isInViewport(s){const t=s.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},isVisibleToUser(s){if(!(s instanceof Element))throw Error("DomUtil: el is not an element.");const t=getComputedStyle(elem);if(t.display==="none"||t.visibility!=="visible"||t.opacity<.1||s.offsetWidth+s.offsetHeight+s.getBoundingClientRect().height+s.getBoundingClientRect().width===0)return!1;const e={x:s.getBoundingClientRect().left+s.offsetWidth/2,y:s.getBoundingClientRect().top+s.offsetHeight/2};if(e.x<0||e.x>(document.documentElement.clientWidth||window.innerWidth)||e.y<0||e.y>(document.documentElement.clientHeight||window.innerHeight))return!1;let i=document.elementFromPoint(e.x,e.y);do if(i===elem)return!0;while(i=i.parentNode);return!1},elementDimPos(s){if(!this.isElement(s))return!1;let t=0,e=0,i=s;for(;i&&i.tagName.toLowerCase()!="body"&&!isNaN(i.offsetLeft)&&!isNaN(i.offsetTop);)t+=i.offsetLeft-i.scrollLeft,e+=i.offsetTop-i.scrollTop,i=i.offsetParent;const n=s.getBoundingClientRect();let r=n.right-n.left,o=n.bottom-n.top,h=this.isVisible(s),a=this.isInViewport(s);return{top:e,left:t,width:r,height:o,visible:h,viewport:a}},elementsDistance(s,t){return el1Location=this.elementDimPos(s),el2Location=this.elementDimPos(t),!el1Location||!el2Location?!1:{x:el1Location.top-el2Location.top,y:el1Location.left.el2Location.left,el1Location,el2Location}},htmlToElement(s){var t=document.createElement("template");return s=s.trim(),t.innerHTML=s,t.content.firstChild},htmlToElements(s){var t=document.createElement("template");return t.innerHTML=s,t.content.childNodes},hideOnClickOutside(s){const t=i=>{!s.contains(i.target)&&this.isVisible(s)&&(s.style.display="none",e())},e=()=>{document.removeEventListener("click",t)};document.addEventListener("click",t)},onClickOutside(s,t){const e=n=>{!s.contains(n.target)&&u.isVisible(s)&&(t(),i())},i=()=>{document.removeEventListener("click",e)};document.addEventListener("click",e)}};function F(s){return Array.isArray(s)}function ct(s){return s&&typeof s=="function"}function C(s){return typeof s=="object"&&!Array.isArray(s)&&s!==null}function y(s){return typeof s=="number"&&!isNaN(s)}function I(s){return typeof s=="boolean"}function S(s){return typeof s=="string"}function Gt(s,t){return!C(s)||!C(t)?t:(Object.keys(t).forEach(e=>{const i=s[e],n=t[e];Array.isArray(i)&&Array.isArray(n)?s[e]=i.concat(n):C(i)&&C(n)?s[e]=Gt(Object.assign({},i),n):s[e]=n}),s)}function Xt(s){if(s===null||typeof s!="object"||"isActiveClone"in s)return s;if(s instanceof Date)var t=new s.constructor;else var t=s.constructor();for(var e in s)Object.prototype.hasOwnProperty.call(s,e)&&(s.isActiveClone=null,t[e]=Xt(s[e]),delete s.isActiveClone);return t}function dt(s="id"){S(s)||(s="ID");const t=Date.now().toString(36),e=Math.random().toString(36).substring(2,5);return`${s}_${t}_${e}`}function ke(s,t){let e=s.length;for(;e--;)if(s[e]!==t[e])return!1;return!0}class ut{#r;#o;#t;#n;#e;#i;#s="stopped";#h;#a;#l=["await","idle","running","stopped"];constructor(t,e){if(this.#r=t.id,this.#e=t,this.#o=t.initial,this.#n=t.context,this.#a=t.actions,this.#i=e,!ut.validateConfig)return!1;this.#d()}get id(){return this.#r}get state(){return this.#o}get previousSate(){return this.#t}get context(){return this.#n}get mediator(){return this.#i}get status(){return this.#s}get event(){return this.#h}get actions(){return this.#a}notify(t,e){this.#h=t;const i=this.#e.states[this.#o];let n=i.on[t];if(!n||!ct(n.action)||this.#s!=="running")return!1;const r=n.target,o=this.#e.states[r];if(i?.onExit(this,e),n.action(this,e),this.#t=this.#o,this.#o=r,o?.onEnter(this,e),this.#e.states[r]?.on&&(this.#e.states[r].on[""]||this.#e.states[r].on?.always)){const h=this.#e.states[r].on[""]||this.#e.states[r].on.always;if(F(h))for(let a of h){let l=a?.condition.type||a?.condition||!1;this.condition(l,null,{cond:l})&&S(a.target)&&(a?.action(this,e),this.#t=this.#o,this.#o=a?.target,this.notify(null,null))}else if(C(h)&&S(h.target)){let a=h?.condition.type||h?.condition||!1;this.condition(a,null,{cond:a})&&S(h.target)&&(h?.action(this,e),this.#t=this.#o,this.#o=h.target,this.notify(null,null))}}return this.#o}condition(t,e=null,i={}){return t?this.#e.guards[t](this.#n,e,i):!1}canTransition(t){const e=this.#e.states[this.#o];return t in e.on}start(){this.#s="running"}stop(){this.#s="stopped"}#d(){const t=new Set;for(let e in this.#e.states)for(let i in this.#e.states[e].on)t.add(i);for(let e of t)this.#i.on(e,i=>{this.notify(e,i)},this.context)}static validateConfig(t){if(!C(t))return!1;const e=["id","initial","context","states"];let i=Object.keys(t);if(!ke(e,i)||!(t.initial in t.states))return!1;for(state in t.states){if("onEnter"in t.states[state]&&!ct(t.states[state])||"onExit"in t.states[state]&&!ct(t.states[state]))return!1;if("on"in t.states[state]){for(let n of t.states[state].on)if(!S(n.target)||"action"in n&&!ct(n.action))return!1}}return!0}}class Yt{valid;#r;#o;#t;#n={};#e;constructor(t,e,i,n){this.#r=t,this.#t=t.hub,this.#o=e;const r=["constructor","start","end","name","shortName","mediator","options"],o=Object.getOwnPropertyNames(i.prototype),h=r.filter(l=>o.includes(l));let a=i.prototype.constructor.name;if("permittedClassNames"in e&&!e?.permittedClassNames.includes(a)&&(a=a.match(/^module_\s*([$A-Z_][0-9A-Z_$]*)/i)),this.valid=r.length===h.length&&a!==null,this.log(`Is Module ${a} valid: ${this.valid}`),this.valid)return new i(this,n)}get api(){return this.#o}get core(){return this.#r}set stateMachine(t){this.#e=new ut(t,this)}get stateMachine(){return this.#e}isStateMachineConfigValid(t){ut.validateConfig(t)}log(t){this.#r.log(t)}info(t){this.#r.info(t)}warning(t){this.#r.warn(t)}error(t){this.#r.error(t)}register(t,e,i,n){const r=this.#r.register(t,e,i,n);return this.#n[r.modID]=r,r}on(t,e,i){this.#t[t]||(this.#t[t]=[]),this.#t[t].push({handler:e,context:i})}off(t,e){const i=(this.#t[t]||[]).findIndex(n=>n===e);i>-1&&this.#t[t].splice(i,1),this.#t[t].length===0&&delete this.#t[t]}emit(t,e){(this.#t[t]||[]).forEach(i=>i.handler.call(i.context,e))}execute(t,e,i){}}function We(s,t,e,i){let n,r,o=!1,h=i.transfer,a=i.adviser,l=i.args;switch(e?r=t[e].bind(t):(o=!0,r=t),i.advised=r,s){case"before":n=function(){Array.prototype.push.call(arguments,l);let c=a.apply(t,arguments);return c=c&&!h?[c]:null,r.apply(t,c||arguments)};break;case"after":n=function(){Array.prototype.push.call(arguments,l);let c=r.apply(t,arguments);return c=c&&!h?[c]:null,a.apply(t,c||arguments)};break;case"around":let d={proceed:function(){return this.method.apply(this,this.args)}};n=function(){return Array.prototype.push.call(arguments,l),d.args=arguments,d.method=r,d.name=e,a(d)};break;default:console.log("AOP Error","Unsupported advice type:  "+s)}return o?t=n:t[e]=n}function nt(s,t,e=null){this.type=s,this.advised=t,this.advisedMethod=e,Object.freeze(this)}nt.prototype.add=function(s,t=null,e=!0,i){if(s=t?s[t].bind(s):s,typeof s!="function")throw new TypeError("[aop] An adviser function is required in addAdvice.");return We(this.type,this.advised,this.advisedMethod,{adviser:s,transfer:e,args:i})},Object.freeze(nt.prototype);var Be={before:function(s,t=null){return new nt("before",s,t)},after:function(s,t){return new nt("after",s,t)},around:function(s,t){return new nt("around",s,t)}};class Ne{#r={};#o=0;#t={};#n;#e;#i={};#s;#h={};logs=!1;infos=!1;warnings=!1;errors=!1;constructor(t){if(C(t))for(const e in t)e in this.props()&&this.props()[e](t[e])}props(){return{logs:t=>this.logs=I(t)?t:!1,infos:t=>this.infos=I(t)?t:!1,warnings:t=>this.warnings=I(t)?t:!1,errors:t=>this.errors=I(t)?t:!1}}get hub(){return this.#h}log(t){this.logs&&console.log(t)}info(t){this.infos&&console.info(t)}warning(t){this.warnings&&console.warn(t)}error(t){this.errors&&console.error(t)}time(t){this.timer&&console.time(t)}timeLog(t){this.timer&&console.timeLog(t)}timeEnd(t){this.timer&&console.timeEnd(t)}subscribe(t,e,i){}unsubscribe(t,e){}publish(t,e,i){}register(t,e,i,n){++this.#o;let r=new Yt(this,n,e,i);if(r.constructor.name==="Mediator")throw new Error("module failed");Be.before(r,"start").add(this,"beforeModStart",!1,t);const o=S(t)?`${t}_${this.#o}`:`${this.#o}`;return r.modID=o,this.#r[o]=r,r}beforeModStart(){const t=arguments[arguments.length-1];this.#i[t]=this.#r[t],this.log(`module ${t} is running`)}hookMountsAdd(t,e){}hookMount(){return this.hookMount.prototype={hooks:[],get:function(){return this.hooks},add:function(t){this.hooks.push(t)},remove:function(t){}},hooks}}var Ue={Core:Ne,Mediator:Yt};const Dt={COLOUR_BG:"#141414",COLOUR_BORDER:"#666",COLOUR_TXT:"#CCC"},ze={COLOUR_ICON:"#888"},Ve={COLOUR_ICON:"#888"},Ot={COLOUR_BG:"#141414",COLOUR_BORDER:"#666",COLOUR_TXT:"#CCC"},At={COLOUR_BG:"#141414",COLOUR_BORDER:"#666",COLOUR_TXT:"#CCC"},gt={COLOUR_CANDLE_UP:"#00F04088",COLOUR_CANDLE_DN:"#F0004088",COLOUR_WICK_UP:"#0F4",COLOUR_WICK_DN:"#F04"},$t={COLOUR_VOLUME_UP:"#00F04088",COLOUR_VOLUME_DN:"#F0004088",ONCHART_VOLUME_HEIGHT:15},jt="normal",Kt=12,Zt="Arial",R={COLOUR_TICK:"#888",COLOUR_LABEL:"888",COLOUR_CURSOR:"#000",COLOUR_CURSOR_BG:"#CCC",FONTFAMILY:Zt,FONTSIZE:Kt,FONTWEIGHT:jt,FONT_LABEL:`${jt} ${Kt}px ${Zt}`},qt="normal",Jt=12,Qt="Arial",H={COLOUR_TICK:"#888",COLOUR_LABEL:"888",FONTFAMILY:Qt,FONTSIZE:Jt,FONTWEIGHT:qt,FONT_LABEL:`${qt} ${Jt}px ${Qt}`},Fe={COLOUR_GRID:"#333"},Pt="TradeX-Chart",te="TradeXChart",Ge="tradeXchart",ft="tradeXutils",ee="tradeXbody",ie="tradeXwidgetsG",mt="tradeXtools",se="tradeXmain",rt="tradeXtime",It="tradeXrows",Xe="tradeXrow",Rt="tradeXgrid",ot="tradeXchart",pt="tradeXscale",ne="tradeXmenus",re="tradeXmenu",oe="tradeXdividers",he="tradeXwindows",Ye="tradeXwindow",Ht=500,je='<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" width="46.08" height="46.08" viewBox="-51.2 -51.2 614.4 614.4" ><path d="M471.993 112h-89.2l-16.242-46.75a32.023 32.023 0 00-30.229-21.5H175.241a31.991 31.991 0 00-30.294 21.691L129.1 112H40a24.027 24.027 0 00-24 24v312a24.027 24.027 0 0024 24h431.993a24.027 24.027 0 0024-24V136a24.027 24.027 0 00-24-24zm-8 328H48.007V144h104.01l23.224-68.25h161.081l23.71 68.25h103.961z" class="ci-primary"></path><path d="M256 168a114 114 0 10114 114 114.13 114.13 0 00-114-114zm0 196a82 82 0 1182-82 82.093 82.093 0 01-82 82z"></path></svg>',Ke='<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" width="46.08" height="46.08" viewBox="-51.2 -51.2 614.4 614.4"><path d="M376 160v32h65.372L252 381.373l-72-72L76.686 412.686l22.628 22.628L180 354.627l72 72 212-211.999V280h32V160H376z"></path><path d="M48 104H16v392h480v-32H48V104z"></path></svg>',Ze='<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" width="46.08" height="46.08" viewBox="-51.2 -51.2 614.4 614.4"><path d="M271.514 95.5h-32v178.111l115.613 54.948 13.737-28.902-97.35-46.268V95.5z"></path><path d="M256 16C123.452 16 16 123.452 16 256s107.452 240 240 240 240-107.452 240-240S388.548 16 256 16zm0 448c-114.875 0-208-93.125-208-208S141.125 48 256 48s208 93.125 208 208-93.125 208-208 208z"></path></svg>',qe='<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" width="46.08" height="46.08" viewBox="-51.2 -51.2 614.4 614.4"><path d="M245.151 168a88 88 0 1088 88 88.1 88.1 0 00-88-88zm0 144a56 56 0 1156-56 56.063 56.063 0 01-56 56z"></path><path d="M464.7 322.319l-31.77-26.153a193.081 193.081 0 000-80.332l31.77-26.153a19.941 19.941 0 004.606-25.439l-32.612-56.483a19.936 19.936 0 00-24.337-8.73l-38.561 14.447a192.038 192.038 0 00-69.54-40.192l-6.766-40.571A19.936 19.936 0 00277.762 16H212.54a19.937 19.937 0 00-19.728 16.712l-6.762 40.572a192.03 192.03 0 00-69.54 40.192L77.945 99.027a19.937 19.937 0 00-24.334 8.731L21 164.245a19.94 19.94 0 004.61 25.438l31.767 26.151a193.081 193.081 0 000 80.332l-31.77 26.153A19.942 19.942 0 0021 347.758l32.612 56.483a19.937 19.937 0 0024.337 8.73l38.562-14.447a192.03 192.03 0 0069.54 40.192l6.762 40.571A19.937 19.937 0 00212.54 496h65.222a19.936 19.936 0 0019.728-16.712l6.763-40.572a192.038 192.038 0 0069.54-40.192l38.564 14.449a19.938 19.938 0 0024.334-8.731l32.609-56.487a19.939 19.939 0 00-4.6-25.436zm-50.636 57.12l-48.109-18.024-7.285 7.334a159.955 159.955 0 01-72.625 41.973l-10 2.636L267.6 464h-44.89l-8.442-50.642-10-2.636a159.955 159.955 0 01-72.625-41.973l-7.285-7.334-48.117 18.024L53.8 340.562l39.629-32.624-2.7-9.973a160.9 160.9 0 010-83.93l2.7-9.972L53.8 171.439l22.446-38.878 48.109 18.024 7.285-7.334a159.955 159.955 0 0172.625-41.973l10-2.636L222.706 48H267.6l8.442 50.642 10 2.636a159.955 159.955 0 0172.625 41.973l7.285 7.334 48.109-18.024 22.447 38.877-39.629 32.625 2.7 9.972a160.9 160.9 0 010 83.93l-2.7 9.973 39.629 32.623z"></path></svg>',Je='<svg width="46.08" height="46.08" aria-hidden="true" version="1.1" viewBox="-51.2 -51.2 614.4 614.4" xmlns="http://www.w3.org/2000/svg"><rect x="16" y="240.18" width="188.84" height="31.635"/><g transform="translate(-3.3234e-7 -112.18)"><rect x="307.16" y="352.37" width="188.84" height="31.635"/></g><rect transform="rotate(-90)" x="-496" y="240.18" width="188.84" height="31.635"/><rect transform="rotate(-90)" x="-204.84" y="240.18" width="188.84" height="31.635"/></svg>',Qe='<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" width="46.08" height="46.08" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"></path><path d="M6.535 3H21a1 1 0 011 1v16a1 1 0 01-1 1H6.535a1 1 0 01-.832-.445l-5.333-8a1 1 0 010-1.11l5.333-8A1 1 0 016.535 3zm.535 2l-4.666 7 4.666 7H20V5H7.07zM13 10.586l2.828-2.829 1.415 1.415L14.414 12l2.829 2.828-1.415 1.415L13 13.414l-2.828 2.829-1.415-1.415L11.586 12 8.757 9.172l1.415-1.415L13 10.586z"></path></svg>',ti='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><rect x="4" y="6" width="16" height="1" rx="0.5"></rect><rect x="4" y="9" width="16" height="1" rx="0.5"></rect><rect x="4" y="15" width="16" height="1" rx="0.5"></rect><rect x="4" y="18" width="16" height="1" rx="0.5"></rect><rect x="4" y="12" width="16" height="1" rx="0.5"></rect><ellipse cx="12" cy="18.5" rx="1.5" ry="1.5"></ellipse><ellipse cx="16" cy="6.5" rx="1.5" ry="1.5"></ellipse><ellipse cx="8" cy="6.5" rx="1.5" ry="1.5"></ellipse></svg>',yt='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><rect x="5.989593505859375" y="17.303298950195312" width="14" height="1" rx="0.5" transform="matrix(0.7071067690849304,-0.7071067690849304,0.7071067690849304,0.7071067690849304,-10.480968421384205,9.30330124707234)"></rect><ellipse cx="16" cy="8" rx="1.5" ry="1.5"></ellipse><ellipse cx="7" cy="17" rx="1.5" ry="1.5"></ellipse></g></svg>',ei='<svg aria-hidden="true" width="46.08" height="46.08" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"> <path d="M 3.2758709,20.241377 11.758622,28.72413 28.72413,11.758622 20.241377,3.2758709 Z m 2.1206881,0 1.5905161,-1.590515 3.7112049,3.711203 1.060342,-1.060345 -3.7112027,-3.711204 1.0603441,-1.060344 2.1206876,2.12069 1.060346,-1.060346 -2.120689,-2.120688 1.060343,-1.060344 3.711203,3.711203 L 16,17.060346 l -3.711203,-3.711208 1.060341,-1.060341 2.12069,2.120687 1.060344,-1.060346 -2.120688,-2.120687 1.060344,-1.060343 3.711204,3.711205 1.060345,-1.060345 -3.711205,-3.7112046 1.060344,-1.0603441 2.120687,2.1206887 1.060346,-1.0603446 -2.120687,-2.1206883 1.590515,-1.5905161 6.362065,6.362063 -14.84482,14.84482 z" style="stroke-width:0.749776" /></svg>',ii='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.5 5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM2 6.5A2.5 2.5 0 0 1 6.95 6H24v1H6.95A2.5 2.5 0 0 1 2 6.5zM4.5 15a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM2 16.5a2.5 2.5 0 0 1 4.95-.5h13.1a2.5 2.5 0 1 1 0 1H6.95A2.5 2.5 0 0 1 2 16.5zM22.5 15a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm-18 6a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM2 22.5a2.5 2.5 0 0 1 4.95-.5H24v1H6.95A2.5 2.5 0 0 1 2 22.5z"></path><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M22.4 8.94l-1.39.63-.41-.91 1.39-.63.41.91zm-4 1.8l-1.39.63-.41-.91 1.39-.63.41.91zm-4 1.8l-1.4.63-.4-.91 1.39-.63.41.91zm-4 1.8l-1.4.63-.4-.91 1.39-.63.41.91z"></path></svg>',si='<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" width="46.08" height="46.08" viewBox="-51.2 -51.2 614.4 614.4"><path d="M231.359 147l-80.921 205h45.155l15.593-39.5h89.628l15.593 39.5h45.155l-80.921-205zm-3.594 123.5L256 198.967l28.235 71.533z"></path><path d="M384 56H128V16H16v112h40v256H16v112h112v-40h256v40h112V384h-40V128h40V16H384zM48 96V48h48v48zm48 368H48v-48h48zm288-40H128v-40H88V128h40V88h256v40h40v256h-40zm80-8v48h-48v-48zM416 48h48v48h-48z"></path></svg>';var ni=[{id:"indicators",name:"Indicators",icon:Ke,event:"utils_indicators",sub:[]},{id:"timezone",name:"Timezone",icon:Ze,event:"utils_timezone"},{id:"settings",name:"Settings",icon:qe,event:"utils_settings"},{id:"screenshot",name:"Screenshot",icon:je,event:"utils_screenshot"}];function ri(s,t,e,i,n,r){s.fillStyle=r,s.fillRect(t,e,i,n)}function oi(s,t,e,i){s.save(),s.lineWidth=e.lineWidth||1,s.lineWidth%2&&s.translate(.5,.5),s.strokeStyle=e.strokeStyle,"dash"in e&&s.setLineDash(e.dash),s.beginPath();let n=!0;t.forEach(r=>{r&&r.x!==null&&(n?(s.moveTo(r.x,r.y),n=!1):s.lineTo(r.x,r.y))}),i(),s.restore()}function hi(s,t,e){oi(s,t,e,()=>{s.stroke(),s.closePath()})}class kt{#r;#o;#t;#n;#e;#i;#s;constructor(t,e,i,n){this.#r=t,this.#o=t.scene,this.#t=n,this.#n=e,this.#e=i,this.#i=n.indicator,this.#s=n.type}get target(){return this.#r}get scene(){return this.#o}get xAxis(){return this.#n}get yAxis(){return this.#e}get type(){return this.#s}get indicator(){return this.#i}plot(t,e,i){const n=this.#o.context;switch(n.save(),e){case"renderLine":hi(n,t,i);case"renderFillRect":ri(n,t[0],t[1],t[2],t[3],i)}n.restore()}}const ai=6,ae=.05,le=100,O=["default","percent","log"],vt=200,wt=200,k=20,li=100,G=20,ce=50,de=30,ci=8;function di(s,t){return s=Math.ceil(s)+1,t=Math.floor(t),Math.floor(Math.random()*(t-s)+s)}function ui(s){const t={};return t.value=s,t.sign=!!s,t.integers=ue(s),t.decimals=ge(s),t.total=t.integers+t.decimals,t}function ue(s){return(Math.log10((s^s>>31)-(s>>31))|0)+1}function gi(s){return s|0}function W(s,t){t=t||100;const e=Math.pow(10,t);return Math.round((s+Number.EPSILON)*e)/e}function ge(s){if(typeof s!="number"&&(s=parseFloat(s)),isNaN(s)||!isFinite(s))return 0;for(var t=1,e=0;Math.round(s*t)/t!==s;)t*=10,e++;return e}function fe(s){return Math.log(s)/Math.log(10)}function me(s,t){return Math.pow(s,t)}class fi extends kt{name="Exponential Moving Average";shortName="EMA";onChart=!0;series="price";calcParams=[6,12,20];precision=2;shouldCheckParamCount=!1;shouldOhlc=!0;plots=[{key:"ema6",title:"EMA6: ",type:"line"},{key:"ema12",title:"EMA12: ",type:"line"},{key:"ema20",title:"EMA20: ",type:"line"}];defaultStyle={strokeStyle:"#C80",lineWidth:"1"};style={};overlay;TALib;static scale=O[0];constructor(t,e,i,n,r){super(t,i,n,r),this.overlay=e,this.style=r.style||this.defaultStyle,this.TALib=i.mediator.api.core.TALib}calcIndicator(t){this.overlay.data=this.TALib.EMA(t)}regeneratePlots(t){return t.map(e=>({key:`ema${e}`,title:`EMA${e}: `,type:"line"}))}calcTechnicalIndicator(t,{params:e,plots:i}){let n=0;const r=[];return t.map((o,h)=>{const a={},l=o.close;return n+=l,e.forEach((d,c)=>{h>=d-1&&(h>d-1?r[c]=(2*l+(d-1)*r[c])/(d+1):r[c]=n/d,a[i[c].key]=r[c])}),a})}draw(t){this.scene.clear();const e=this.overlay.data,i=W(this.scene.width/t.Length,1),n=[],r=this.xAxis.smoothScrollOffset||0,o={x:i*.5+2+r-i*2,w:i};let h=t.indexStart-1<0?0:2,a=t.indexStart-(t.data.length-this.overlay.data.length)-h,l=t.Length+h+1;for(;l;)a<0||a>=this.overlay.data.length?n[t.Length+h+1-l]={x:null,y:null}:(o.y=this.yAxis.yPos(100-e[a][1]),n[t.Length+h+1-l]={...o}),a++,l--,o.x=o.x+o.w;this.plot(n,"renderLine",this.style),this.target.viewport.render()}}class mi extends kt{name="Relative Strength Index";shortName="RSI";onChart=!1;calcParams=[20];checkParamCount=!1;plots=[{key:"RSI_1",title:" ",type:"line"}];defaultStyle={strokeStyle:"#C80",lineWidth:"1",defaultHigh:75,defaultLow:25,highLowLineWidth:1,highLowStyle:"dashed",highStrokeStyle:"#848",lowStrokeStyle:"#848",highLowRangeStyle:"#22002220"};style={};overlay;TALib;static scale=O[1];constructor(t,e,i,n,r){super(t,i,n,r),this.overlay=e,this.style={...this.defaultStyle,...r.style},this.TALib=i.mediator.api.core.TALib}calcIndicator(t){this.overlay.data=this.TALib.EMA(t)}regeneratePlots(t){return t.map((e,i)=>{const n=i+1;return{key:`rsi${n}`,title:`RSI${n}: `,type:"line"}})}calcTechnicalIndicator(t,{params:e,plots:i}){const n=[],r=[];return t.map((o,h)=>{const a={},l=(t[h-1]||o).close,d=o.close-l;return e.forEach((c,g)=>{if(d>0?n[g]=(n[g]||0)+d:r[g]=(r[g]||0)+Math.abs(d),h>=c-1){r[g]!==0?a[i[g].key]=100-100/(1+n[g]/r[g]):a[i[g].key]=0;const p=t[h-(c-1)],L=t[h-c]||p,M=p.close-L.close;M>0?n[g]-=M:r[g]-=Math.abs(M)}}),a})}draw(t){this.scene.clear();const e=this.overlay.data,i=this.xAxis.candleW,n=this.scene.width+this.xAxis.bufferPx*2,r=this.yAxis.yPos(100-this.style.defaultHigh),o=this.yAxis.yPos(100-this.style.defaultLow),h=[0,r,this.scene.width,o-r];let a=this.style.highLowRangeStyle;this.plot(h,"renderFillRect",a),h.length=0,h[0]={x:0,y:r},h[1]={x:n,y:r},a={lineWidth:this.style.highLowLineWidth,strokeStyle:this.style.highStrokeStyle,dash:[5,5]},this.plot(h,"renderLine",a),h.length=0,h[0]={x:0,y:o},h[1]={x:n,y:o},a={lineWidth:this.style.highLowLineWidth,strokeStyle:this.style.lowStrokeStyle,dash:[5,5]},this.plot(h,"renderLine",a),h.length=0;const l=this.xAxis.smoothScrollOffset||0,d={x:i*.5+2+l-i*2,w:i};let c=this.xAxis.rangeScrollOffset,g=t.indexStart-(t.data.length-this.overlay.data.length)-c-1,p=t.Length+c+3;for(;p;)g<0||g>=this.overlay.data.length?h[t.Length+c+1-p]={x:null,y:null}:(d.y=this.yAxis.yPos(100-e[g][1]),h[t.Length+c+1-p]={...d}),g++,p--,d.x=d.x+d.w;this.plot(h,"renderLine",this.style),this.target.viewport.render()}}var Wt={ADX:{id:"ADX",name:"Average Direction",event:"addIndicator"},BB:{id:"BB",name:"Bollinger Bands",event:"addIndicator",ind:""},EMA:{id:"EMA",name:"Exponential Moving Average",event:"addIndicator",ind:fi},DMI:{id:"DMI",name:"Directional Movement",event:"addIndicator"},RSI:{id:"RSI",name:"Relative Strength Index",event:"addIndicator",ind:mi}};class pi{#r="Utilities";#o="utils";#t;#n;#e;#i;#s;#h;#a;#l={};constructor(t,e){this.#t=t,this.#n=e,this.#e=t.api.elements.elUtils,this.#i=ni||e.utilsBar,this.#s=this.#t.api.core,this.#h=this.#t.api.core.WidgetsG,this.#a=this.options.indicators||Wt,this.init()}log(t){this.#t.log(t)}info(t){this.#t.info(t)}warning(t){this.#t.warn(t)}error(t){this.#t.error(t)}get name(){return this.#r}get shortName(){return this.#o}get mediator(){return this.#t}get options(){return this.#n}get pos(){return this.dimensions}get dimensions(){return u.elementDimPos(this.#e)}init(){this.mount(this.#e),this.log(`${this.#r} instantiated`)}start(){this.initAllUtils(),this.eventsListen()}end(){const t=this.#t.api,e=u.findBySelectorAll(`#${t.id} .${ft} .icon-wrapper`);for(let i of e)for(let n of this.#i)n.id===id&&i.removeEventListener("click",this.onIconClick)}eventsListen(){this.on("utils_indicators",t=>{this.onIndicators(t)}),this.on("utils_timezone",t=>{this.onTimezone(t)}),this.on("utils_settings",t=>{this.onSettings(t)}),this.on("utils_screenshot",t=>{this.onScreenshot(t)})}on(t,e,i){this.#t.on(t,e,i)}off(t,e){this.#t.off(t,e)}emit(t,e){this.#t.emit(t,e)}onIconClick(t){let e=t.currentTarget.dataset.event,i=t.currentTarget.dataset.menu||!1,n={target:t.currentTarget.id,menu:i,evt:t.currentTarget.dataset.event};this.emit(e,n),i?this.emit("openMenu",n):(this.emit("menuItemSelected",n),this.emit("utilSelected",n))}mount(t){t.innerHTML=this.defaultNode()}initAllUtils(){const t=this.#t.api,e=u.findBySelectorAll(`#${t.id} .${ft} .icon-wrapper`);for(let i of e){let n=i.id.replace("TX_",""),r=i.querySelector("svg");r.style.fill=Ve.COLOUR_ICON,r.style.height="90%";for(let o of this.#i)if(o.id===n&&(i.addEventListener("click",this.onIconClick.bind(this)),o.id==="indicators"&&(o.sub=Object.values(this.#a)),o?.sub)){let h={content:o.sub,primary:i},a=this.#h.insert("Menu",h);i.dataset.menu=a.id,a.start()}}}defaultNode(){let t="";for(const e of this.#i)t+=this.iconNode(e);return t}iconNode(t){const e=`display: inline-block; height: ${this.#e.clientHeight}px; padding-top: 2px`,i="sub"in t?'data-menu="true"':"";return`
      <div id="TX_${t.id}" data-event="${t.event}" ${i} class="icon-wrapper" style="${e}">${t.icon}</div>

    `}onIndicators(t){console.log("Indicator:",t)}onTimezone(t){console.log("Timezone:",t),this.#s.notImplemented()}onSettings(t){console.log("Settings:",t),this.#s.notImplemented()}onScreenshot(t){console.log("Screenshot:",t),this.#s.notImplemented()}}var yi=[{id:"cursor",name:"Cursor",icon:Je,event:"tools_cursor",action:(s,t)=>{console.log("Cursor Selected")}},{id:"line",name:"Line",icon:yt,event:"tools_line",action:(s,t)=>{console.log("Line tool")},sub:[{id:"ray",name:"Ray",icon:yt,event:"tools_ray",action:(s,t)=>{console.log("Ray Selected")}},{id:"hRay",name:"Horizontal Ray",icon:yt,event:"tools_horizonalRay",action:(s,t)=>{console.log("Horizontal Ray Selected")}},{id:"vRay",name:"Vertical Ray",icon:yt,event:"tools_verticalRay",action:(s,t)=>{console.log("Vertical Ray Selected")}}]},{id:"fibonacci",name:"Fibonacci",icon:ti,event:"tools_fibonacci",action:(s,t)=>{console.log("Fibonacci tool")},sub:[]},{id:"range",name:"Range",icon:ii,event:"tools_range",action:(s,t)=>{console.log("Range tool")},sub:[]},{id:"text",name:"Text",icon:si,event:"tools_text",action:(s,t)=>{console.log("Text tool")},sub:[]},{id:"measure",name:"Measure",icon:ei,event:"tools_measure",action:(s,t)=>{console.log("Measure tool")}},{id:"delete",name:"Delete",icon:Qe,event:"tools_delete",action:(s,t)=>{console.log("Delete tool")}}];class vi{#r="Toolbar";#o="tools";#t;#n;#e;#i;#s;constructor(t,e){this.#t=t,this.#n=e,this.#e=t.api.elements.elTools,this.#i=yi||e.tools,this.#s=this.#t.api.core.WidgetsG,this.init()}log(t){this.#t.log(t)}info(t){this.#t.info(t)}warning(t){this.#t.warn(t)}error(t){this.#t.error(t)}get name(){return this.#r}get shortName(){return this.#o}get mediator(){return this.#t}get options(){return this.#n}get pos(){return this.dimensions}get dimensions(){return u.elementDimPos(this.#e)}init(){this.mount(this.#e),this.log(`${this.#r} instantiated`)}start(){this.initAllTools(),this.eventsListen()}end(){const t=this.#t.api,e=u.findBySelectorAll(`#${t.id} .${mt} .icon-wrapper`);for(let i of e)for(let n of this.#i)n.id===id&&i.removeEventListener("click",this.onIconClick)}eventsListen(){}on(t,e,i){this.#t.on(t,e,i)}off(t,e){this.#t.off(t,e)}emit(t,e){this.#t.emit(t,e)}onIconClick(t){let e=t.currentTarget.dataset.event,i=t.currentTarget.dataset.menu||!1,n={target:t.currentTarget.id,menu:i,evt:t.currentTarget.dataset.event};this.emit(e,n),i?this.emit("openMenu",n):(this.emit("menuItemSelected",n),this.emit("toolSelected",n))}mount(t){t.innerHTML=this.defaultNode()}initAllTools(){const t=this.#t.api,e=u.findBySelectorAll(`#${t.id} .${mt} .icon-wrapper`);for(let i of e){let n=i.id.replace("TX_",""),r=i.querySelector("svg");r.style.fill=ze.COLOUR_ICON,r.style.width="90%";for(let o of this.#i)if(o.id===n&&(i.addEventListener("click",this.onIconClick.bind(this)),o?.sub)){let h={content:o.sub,primary:i},a=this.#s.insert("Menu",h);i.dataset.menu=a.id,a.start()}}}defaultNode(){let t="";for(const e of this.#i)t+=this.iconNode(e);return t}iconNode(t){const e=`display: inline-block; height: ${this.#e.clientWidth}px; padding-right: 2px`,i="sub"in t?'data-menu="true"':"";return`
      <div id="TX_${t.id}" data-event="${t.event}" ${i} class="icon-wrapper" style="${e}">${t.icon}</div>

    `}}class pe{constructor(t){}get width(){return this.chart.width}get height(){return this.chart.height}get data(){return this.chart.data}get range(){return this.chart.range}get yDigits(){return this.chart.yAxisDigits}float2Int(t){return gi(t)}numDigits(t){return ue(t)}countDigits(t){return ui(t)}precision(t){return ge(t)}}const wi=["y","M","d","h","m","s","ms"],xi=["years","months","days","hours","minutes","seconds","milliseconds"],Ci=[0,31,59,90,120,151,181,212,243,273,304,334],Mi=[0,31,60,91,121,152,182,213,244,274,305,335],ye=[31,28,31,30,31,30,31,31,30,31,30,31],ve=1231006505e3,ht=1e3,Z=ht*60,A=Z*60,v=A*24,xt=v*7,Ct=v*30;function Bt(s=3,t=!1){let e=ye[s%12]*v;return t&&s>0&&(e+=v),e}const B=v*365,Mt={y:B,M:Ct,w:xt,d:v,h:A,m:Z,s:ht},we={years:B,months:Ct,weeks:xt,days:v,hours:A,minutes:Z,seconds:ht},Li={...Mt,...we};function xe(){const s={};for(let t in Mt){let e=0;s[t]=[];do s[t].push(Math.round(Mt[t]*e)),e+=.125;while(e<1)}return s}function Ce(s){const t=new Date(s).getTime();return y(t)}function Me(s,t=ve,e=Date.now()){return Ce(s)?s>t&&s<e:!1}const N={inSeconds:function(s,t){s=new Date(s),t=new Date(t);var e=t.getTime(),i=s.getTime();return parseInt((e-i)/ht)},inMinutes:function(s,t){s=new Date(s),t=new Date(t);let e=t.getTime(),i=s.getTime();return parseInt((e-i)/Z)},inHours:function(s,t){s=new Date(s),t=new Date(t);let e=t.getTime(),i=s.getTime();return parseInt((e-i)/A)},inDays:function(s,t){s=new Date(s),t=new Date(t);let e=t.getTime(),i=s.getTime();return parseInt((e-i)/v)},inWeeks:function(s,t){s=new Date(s),t=new Date(t);let e=t.getTime(),i=s.getTime();return parseInt((e-i)/xt)},inMonths:function(s,t){s=new Date(s),t=new Date(t);let e=s.getUTCFullYear(),i=t.getUTCFullYear(),n=s.getUTCMonth();return t.getUTCMonth()+12*i-(n+12*e)},inYears:function(s,t){let e=new Date(s);return new Date(t).getUTCFullYear()-e.getUTCFullYear()}};function q(s,t){let e=N.inYears(s,t),i=N.inMonths(s,t),n=N.inWeeks(s,t),r=N.inDays(s,t),o=N.inHours(s,t),h=N.inMinutes(s,t),a=N.inSeconds(s,t),l=new Date(t).getTime()-new Date(s).getTime();return{y:e,M:i,w:n,d:r,h:o,m:h,s:a,ms:l,years:e,months:i,weeks:n,days:r,hours:o,minutes:h,seconds:a,milliseconds:l}}function Lt(s){let t=Math.floor(s/1e3),e=Math.floor(t/60);t=t%60;let i=Math.floor(e/60);e=e%60;let n=Math.floor(i/24);i=i%24;let r=Math.floor(n/7);n=n%7;let o=Math.floor(r/4),h=Math.floor(r/52),a=r%4;return o=o%13,{y:h,M:o,w:a,d:n,h:i,m:e,s:t,years:h,months:o,weeks:a,days:n,hours:i,minutes:e,seconds:t}}function Nt(s){const t=Lt(s);for(const e in t)if(t[e])return`${t[e]}${e}`}function U(s){return s?new Date(s).getUTCMinutes():null}function Le(s){return new Date(s).setUTCSeconds(0,0)}function z(s){return s?new Date(s).getUTCHours():null}function Ut(s){return new Date(s).setUTCMinutes(0,0,0)}function J(s){return s?new Date(s).getUTCDate():null}function Se(s,t="en-GB",e="short"){return new Date(s).toLocaleDateString(t,{weekday:e})}function $(s){return new Date(s).setUTCHours(0,0,0,0)}function Q(s){if(!!s)return new Date(s).getUTCMonth()}function X(s,t="en-GB",e="short"){return new Date(s).toLocaleDateString(t,{month:e})}function Y(s){let t=new Date(s);return Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),1)}function Si(s){let t=(Q(s)+1)%12;return s+=Bt(t,Tt(s)),s}function tt(s){if(!!s)return new Date(s).getUTCFullYear()}function St(s){return Date.UTC(new Date(s).getUTCFullYear())}function zt(s){return s=s+B+v,Tt(s),s}function Tt(s){let e=new Date(s).getUTCFullYear();return(e&3)!=0?!1:e%100!=0||e%400==0}function Ti(s){let t=new Date(s),e=t.getUTCMonth(),i=t.getUTCDate(),n=dayCount[e]+i;return e>1&&Tt()&&n++,n}var _i=Object.freeze(Object.defineProperty({__proto__:null,TIMEUNITS:wi,TIMEUNITSLONG:xi,dayCntInc:Ci,dayCntLeapInc:Mi,monthDayCnt:ye,BTCGENESIS:ve,SECOND_MS:ht,MINUTE_MS:Z,HOUR_MS:A,DAY_MS:v,WEEK_MS:xt,MONTHR_MS:Ct,MONTH_MS:Bt,YEAR_MS:B,TIMEUNITSVALUESSHORT:Mt,TIMEUNITSVALUESLONG:we,TIMEUNITSVALUES:Li,buildSubGrads:xe,isValidTimestamp:Ce,isValidTimeInRange:Me,timestampDiff:N,timestampDifference:q,ms2TimeUnits:Lt,ms2Interval:Nt,get_minute:U,minute_start:Le,get_hour:z,hour_start:Ut,get_day:J,get_dayName:Se,day_start:$,get_month:Q,get_monthName:X,month_start:Y,nextMonth:Si,get_year:tt,year_start:St,nextYear:zt,isLeapYear:Tt,dayOfYear:Ti},Symbol.toStringTag,{value:"Module"}));class Ei extends pe{#r;#o;#t;#n=4;#e;#i;#s;constructor(t,e){super(),this.#t=e,this.#o=t,this.#r=this.#o.mediator.api.core,this.#i=xe()}get chart(){return this.#o.mediator.api.Chart}get data(){return this.chart.data}get range(){return this.#o.range}get width(){return this.calcWidth()}get interval(){return this.range.interval}get intervalStr(){return this.range.intervalStr}get timeStart(){return this.range.timeStart}get timeFinish(){return this.range.timeFinish}get rangeDuration(){return this.range.rangeDuration}get indexStart(){return this.range.indexStart}get indexEnd(){return this.range.indexEnd}get timeMax(){return this.range.timeMax}get timeMin(){return this.range.timeMin}get candleW(){return W(this.width/this.range.Length,1)}get gradsMax(){return Math.trunc(this.width/li)}gradsYear(t){return tt(t)}gradsMonthName(t){return X(t)}gradsDayName(t){return Se(t)+" "+J(t)}gradsHour(t){return z(t)+":00"}gradsMinute(t){return"00:"+U(t)}get xAxisRatio(){return this.width/this.range.rangeDuration}set xAxisTicks(t){this.#n=y(t)?t:0}get xAxisTicks(){return this.#n}get xAxisGrads(){return this.#e}get xAxisSubGrads(){return this.#i}get scrollOffsetPx(){return this.#r.scrollPos%this.candleW}get bufferPx(){return this.#r.bufferPx}calcWidth(){return this.#r.Chart.width-this.#r.Chart.scale.width}xPos(t){return(t-this.range.timeMin)*this.xAxisRatio+this.candleW*.5}t2Pixel(t){return(t-this.range.timeMin)*this.xAxisRatio+this.candleW*.5}pixel2T(t){let e=this.pixel2Index(t);return this.range.value(e)[0]}pixel2Index(t){return Math.floor(t/this.candleW)+this.range.indexStart}pixelOHLCV(t){let e=Math.floor(t/this.candleW)+this.range.indexStart;return this.range.value(e)}xPosSnap2CandlePos(t){return Math.round(t/this.candleW)*this.candleW+this.candleW/2}xPos2Time(t){return this.pixel2T(t)}xPos2Index(t){return this.pixel2Index(t)}xPosOHLCV(t){return this.pixelOHLCV(t)}initXAxisGrads(){this.#e=this.calcXAxisGrads()}calcXAxisGrads(){const t=this.timeMin,e=this.timeMax,i=this.intervalStr,n={values:[]};i.charAt(i.length-1);let r,o,h,a,l,d,c,g,p,L,M,w,b;if(g=Lt(this.rangeDuration),n.units=Lt(this.rangeDuration),g.years>0)for(n.unit=["y","year"],n.timeSpan=`${g.years} years`,d=St(t),c=zt(St(e))+B,g=q(d,c),p=g.years,b=Math.ceil(1/(this.gradsMax/p)),w=g.years>=this.gradsMax-1?0:Math.floor(this.gradsMax/p),L=f=>tt(f),M=f=>Q(f)==0?tt(f):X(f),l=d,o=Math.round((B+v)/(w+1)),n.major=[],n.minor=[];l<c;){l=St(l),n.major.push(l),a=l;for(let f=b;f>-1;--f)a=zt(a);if(w>0&&this.interval<B)for(;l<a;)l=Y(l+o),n.minor.push(l);l=a}else if(g.months>0){let f=g.months;for(n.unit=["M","month"],n.timeSpan=`${g.months} months`,d=Y(t),c=Y(e)+Bt(Q(e))+B,g=q(d,c),p=f,b=Math.ceil(1/(this.gradsMax/p)),w=f>=this.gradsMax-1?0:Math.floor(this.gradsMax/p),n.majorTick=b,n.minorTick=w,L=D=>Q(D)==0?tt(D):X(D),M=D=>J(D)==1?X(D):this.gradsDayName(D),l=d,o=Math.round(v*28/(w+1)),n.inc=o,n.major=[],n.minor=[];l<c;){l=Y(l),n.major.push(l),a=l;for(let D=b;D>0;D--)a=Y(a+v*31);if(w>0&&this.interval<v*28)for(h=Y(l+v*31);l<h&&(l=$(l+o),!(l>=h));){if(h-l<o*.75)break;n.minor.push(l)}l=a}}else if(g.weeks>0||g.days>0)for(r=g.weeks*7+g.days,n.unit=["d","day"],n.timeSpan=`${r} days`,d=$(t),c=$(e)+Ct,g=q(d,c),p=r,b=Math.ceil(1/(this.gradsMax/p)),w=r>=this.gradsMax-1?0:Math.floor(this.gradsMax/p),L=f=>Q(f)==0&&J(f)==1?tt(f):J(f)==1?X(f):this.gradsDayName(f),M=f=>J(f)==1?X(f):z(f)==0?this.gradsDayName(f):z(f)+":00",l=d,o=Math.round(v/(w+1)),n.major=[],n.minor=[];l<c;){l=$(l),n.major.push(l),a=l;for(let f=b;f>0;f--)a=a+v;if(w>0&&this.interval<v)for(;l<a;)l=Ut(l+o),n.minor.push(l);l=a}else if(g.hours>0)for(n.unit=["h","hour"],n.timeSpan=`${g.hours} hours`,d=$(t),c=$(e)+v,g=q(d,c),p=g.hours,b=Math.ceil(1/(this.gradsMax/p)),w=g.hours>=this.gradsMax-1?0:Math.floor(this.gradsMax/p),L=f=>z(f)==0?this.gradsDayName(f):U(f)==0?z(f)+":00":"00:"+U(f),M=f=>U(f)==0?z(f)+":00":"00:"+U(f),l=d,o=Math.round(A/(w+1)),n.major=[],n.minor=[];l<c;){l=Ut(l),n.major.push(l),a=l;for(let f=b;f>-1;--f)a=a+A;if(w>0&&this.interval<A)for(;l<a;)l=Le(l+o),n.minor.push(l);l=a}else if(g.minutes>0)for(n.unit=["m","minute"],n.timeSpan=`${g.minutes} minutes`,d=$(t),c=$(e)+A,g=q(d,c),p=g.minutes,b=Math.ceil(this.gradsMax/p),w=g.minutes>=this.gradsMax-1?0:Math.floor(this.gradsMax/p),L=f=>U(f)==0?z(f)+":00":"00:"+U(f),l=d,n.major=[],n.minor=[];l<c;){n.major.push(l),a=l;for(let f=b;f>-1;--f)a=a+Z;l=a}let lt=-1;for(;++lt<n.major.length;)l=n.major[lt],n.values.push([L(l),this.t2Pixel(l),l,"major"]);for(lt=-1;++lt<n.minor.length;)l=n.minor[lt],n.values.push([M(l),this.t2Pixel(l),l,"minor"]);return n}idealTicks(t,e,i){let n=t,r=[];do{let o=-1;for(;++o<this.#i[i].length;)n+=this.#i[i][o],r.push(n)}while(n<e);return r}draw(){this.#e=this.calcXAxisGrads(),this.drawGrads(),this.drawOverlays()}drawGrads(){this.#o.layerLabels.scene.clear();const t=this.#e.values,e=this.#o.layerLabels.scene.context;this.width/this.range.Length*.5;const i=0;e.save(),e.strokeStyle=H.COLOUR_TICK,e.fillStyle=H.COLOUR_TICK,e.font=H.FONT_LABEL;for(let n of t){let r=Math.floor(e.measureText(`${n[0]}`).width*.5);e.fillText(n[0],n[1]-r+i,this.xAxisTicks+12),e.beginPath(),e.moveTo(n[1]+i,0),e.lineTo(n[1]+i,this.xAxisTicks),e.stroke()}e.restore()}drawOverlays(){this.#o.layerOverlays.scene.clear(),this.#e}}class bi{constructor(t){t||(t={}),this.container=t.container,this.layers=[],this.id=m.idCnt++,this.scene=new m.Scene,this.setSize(t.width||0,t.height||0),t.container.innerHTML="",t.container.appendChild(this.scene.canvas),m.viewports.push(this)}setSize(t,e){return this.width=t,this.height=e,this.scene.setSize(t,e),this.layers.forEach(function(i){i.setSize(t,e)}),this}addLayer(t){return this.layers.push(t),t.setSize(t.width||this.width,t.height||this.height),t.viewport=this,this}getIntersection(t,e){for(var i=this.layers,n=i.length,r=n-1,o,h;r>=0;){if(o=i[r],h=o.hit.getIntersection(t,e),h>=0)return h;r--}return-1}getIndex(){let t=m.viewports,e,i=0;for(e of t){if(this.id===e.id)return i;i++}return null}destroy(){for(let t of layers)t.remove();this.container.innerHTML="",m.viewports.splice(this.getIndex(),1)}render(){let t=this.scene,e=this.layers,i;t.clear();for(i of e)i.visible&&t.context.drawImage(i.scene.canvas,i.x,i.y,i.width,i.height)}}class Di{constructor(t){t||(t={}),this.id=m.idCnt++,this.x=0,this.y=0,this.width=0,this.height=0,this.visible=!0,this.hit=new m.Hit({contextType:t.contextType}),this.scene=new m.Scene({contextType:t.contextType}),t.x&&t.y&&this.setPosition(t.x,t.y),t.width&&t.height&&this.setSize(t.width,t.height)}setPosition(t,e){return this.x=t,this.y=e,this}setSize(t,e){return this.width=t,this.height=e,this.scene.setSize(t,e),this.hit.setSize(t,e),this}moveUp(){let t=this.getIndex(),e=this.viewport,i=e.layers;return t<i.length-1&&(i[t]=i[t+1],i[t+1]=this),this}moveDown(){let t=this.getIndex(),e=this.viewport,i=e.layers;return t>0&&(i[t]=i[t-1],i[t-1]=this),this}moveTop(){let t=this.getIndex(),e=this.viewport,i=e.layers;i.splice(t,1),i.push(this)}moveBottom(){let t=this.getIndex(),e=this.viewport,i=e.layers;return i.splice(t,1),i.unshift(this),this}getIndex(){let t=this.viewport.layers;t.length;let e=0,i;for(i of t){if(this.id===i.id)return e;e++}return null}remove(){this.viewport.layers.splice(this.getIndex(),1)}}class Oi{constructor(t){t||(t={}),this.id=m.idCnt++,this.width=0,this.height=0,this.contextType=t.contextType||"2d",this.canvas=document.createElement("canvas"),this.canvas.className="scene-canvas",this.canvas.style.display="block",this.context=this.canvas.getContext(this.contextType),t.width&&t.height&&this.setSize(t.width,t.height)}setSize(t,e){return this.width=t,this.height=e,this.canvas.width=t*m.pixelRatio,this.canvas.style.width=`${t}px`,this.canvas.height=e*m.pixelRatio,this.canvas.style.height=`${e}px`,this.contextType==="2d"&&m.pixelRatio!==1&&this.context.scale(m.pixelRatio,m.pixelRatio),this}clear(){let t=this.context;return this.contextType==="2d"?t.clearRect(0,0,this.width*m.pixelRatio,this.height*m.pixelRatio):t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this}toImage(t="image/png",e,i){let n=this,r=new Image,o=this.canvas.toDataURL(t,e);r.onload=function(){r.width=n.width,r.height=n.height,i(r)},r.src=o}export(t,e,i="image/png",n){typeof e!="function"&&(e=this.blobCallback.bind({cfg:t})),this.canvas.toBlob(e,i,n)}blobCallback(t){let e=document.createElement("a"),i=URL.createObjectURL(t),n=this.cfg.fileName||"canvas.png";e.setAttribute("href",i),e.setAttribute("target","_blank"),e.setAttribute("export",n),document.createEvent?Object.assign(document.createElement("a"),{href:i,target:"_blank",export:n}).click():e.click&&e.click()}}class Ai{constructor(t){t||(t={}),this.width=0,this.height=0,this.contextType=t.contextType||"2d",this.canvas=document.createElement("canvas"),this.canvas.className="hit-canvas",this.canvas.style.display="none",this.canvas.style.position="relative",this.context=this.canvas.getContext(this.contextType,{preserveDrawingBuffer:!0,antialias:!1}),t.width&&t.height&&this.setSize(t.width,t.height)}setSize(t,e){return this.width=t,this.height=e,this.canvas.width=t*m.pixelRatio,this.canvas.style.width=`${t}px`,this.canvas.height=e*m.pixelRatio,this.canvas.style.height=`${e}px`,this}clear(){let t=this.context;return this.contextType==="2d"?t.clearRect(0,0,this.width*m.pixelRatio,this.height*m.pixelRatio):t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this}getIntersection(t,e){let i=this.context,n;if(t=Math.round(t),e=Math.round(e),t<0||e<0||t>this.width||e>this.height)return-1;if(this.contextType==="2d"){if(n=i.getImageData(t,e,1,1).data,n[3]<255)return-1}else if(n=new Uint8Array(4),i.readPixels(t*m.pixelRatio,(this.height-e-1)*m.pixelRatio,1,1,i.RGBA,i.UNSIGNED_BYTE,n),n[0]===255&&n[1]===255&&n[2]===255)return-1;return this.rgbToInt(n)}getColorFromIndex(t){let e=this.intToRGB(t);return"rgb("+e[0]+", "+e[1]+", "+e[2]+")"}rgbToInt(t){let e=t[0],i=t[1],n=t[2];return(e<<16)+(i<<8)+n}intToRGB(t){let e=(t&16711680)>>16,i=(t&65280)>>8,n=t&255;return[e,i,n]}}const m={idCnt:0,viewports:[],pixelRatio:window&&window.devicePixelRatio||1,Viewport:bi,Layer:Di,Scene:Oi,Hit:Ai},at={fontSize:12,fontWeight:"normal",fontFamily:"Helvetica Neue",paddingLeft:3,paddingRight:3,paddingTop:2,paddingBottom:2,borderSize:0,txtCol:"#000",bakCol:"#CCC"};function $i(s,t){return Math.round(s.measureText(t).width)}function Te(s=at.fontSize,t=at.fontWeight,e=at.fontFamily){return`${t} ${s}px ${e}`}function _e(s,t,e){s.font=Te(e.fontSize,e.fontWeight,e.fontFamily);const i=$i(s,t),n=e.paddingLeft||0,r=e.paddingRight||0,o=e.borderSize||0;return n+r+i+o*2}function Pi(s){const t=s.paddingTop||0,e=s.paddingBottom||0,i=s.borderSize||0,n=s.fontSize||0;return t+e+n+i*2}function Ee(s,t,e,i,n){s.save(),s.font=Te(n?.fontSize,n?.fontWeight,n?.fontFamily),s.textBaseline="top",s.fillStyle=n.bakCol||at.bakCol;let r=_e(s,t,n),o=Pi(n);s.fillRect(e,i,r,o),s.fillStyle=n.txtCol||at.txtCol,e=e+n?.paddingLeft,i=i+n?.paddingTop,s.fillText(t,e,i),s.restore()}const x={None:0,DragReady:1,Dragging:2};class et{constructor(){this.set(...arguments)}set(){if(arguments.length===0)this.x=0,this.y=0;else if(arguments.length===1){const{x:t,y:e}=arguments[0];this.x=t,this.y=e}else if(arguments.length>1){const[t,e]=arguments;this.x=t,this.y=e}}clone(){return new et(this.x,this.y)}}const it={None:0,Left:1,Middle:2,Right:3};class Ii{constructor(t){this.controller=t,this.element=t.element,this.position=new et,this.movement=new et,this.firstMovementUpdate=!0,this.dragstart=new et,this.dragend=new et,this.dragCheckThreshold=3,this.wheeldelta=0,this.pressedButtons=[],this.attach()}attach(){const t=this.element,e=this.controller;t.addEventListener("mousedown",i=>{const n=t.getBoundingClientRect();switch(this.position.x=i.clientX-n.left,this.position.y=i.clientY-n.top,this.movement.x=0,this.movement.y=0,this.dragstart.x=this.position.x,this.dragstart.y=this.position.y,i.button){case 0:this.pressedButtons._t_pushIfNotExist(it.Left);break;case 1:this.pressedButtons._t_pushIfNotExist(it.Middle);break;case 2:this.pressedButtons._t_pushIfNotExist(it.Right);break}this.controller.operationMode=x.DragReady,e.raise(this,"mousedown",this.createEventArgument(i))}),t.addEventListener("mousemove",i=>{if(e.operationMode==x.DragReady)(Math.abs(this.position.x-this.dragstart.x)>this.dragCheckThreshold||Math.abs(this.position.y-this.dragstart.y)>this.dragCheckThreshold)&&(e.raise(this,"begindrag",this.createEventArgument(i)),e.operationMode=x.Dragging);else if(e.operationMode===x.None){const n=t.getBoundingClientRect(),r={x:i.clientX-n.left,y:i.clientY-n.top};this.firstMovementUpdate?(this.movement.x=0,this.movement.y=0,this.firstMovementUpdate=!1):(this.movement.x=r.x-this.position.x,this.movement.y=r.y-this.position.y),this.position.x=r.x,this.position.y=r.y,(Math.abs(this.movement.x)>0||Math.abs(this.movement.y)>0)&&e.raise(this,"mousemove",this.createEventArgument(i))}}),t.addEventListener("wheel",i=>{this.wheeldelta=i.wheelDelta;const n=this.createEventArgument(i);if(e.raise(this,"mousewheel",n),n.isProcessed)return i.preventDefault(),!1},{passive:!1}),t.addEventListener("mouseenter",i=>{e.raise(this,"mouseenter",this.createEventArgument(i))}),t.addEventListener("mouseout",i=>{e.raise(this,"mouseout",this.createEventArgument(i))}),window.addEventListener("mousemove",i=>{const n=t.getBoundingClientRect(),r={x:i.clientX-n.left,y:i.clientY-n.top};switch(this.firstMovementUpdate?(this.movement.x=0,this.movement.y=0,this.firstMovementUpdate=!1):(this.movement.x=r.x-this.position.x,this.movement.y=r.y-this.position.y),this.position.x=r.x,this.position.y=r.y,e.operationMode){case x.Dragging:e.raise(this,"drag",this.createEventArgument(i));break}}),t.addEventListener("mouseup",i=>{e.operationMode!==x.Dragging&&e.raise(this,"mouseup",this.createEventArgument(i))}),window.addEventListener("mouseup",i=>{switch(e.operationMode===x.Dragging&&e.raise(this,"enddrag",this.createEventArgument(i)),e.operationMode=x.None,i.button){case 0:this.pressedButtons._t_remove(it.Left);break;case 1:this.pressedButtons._t_remove(it.Middle);break;case 2:this.pressedButtons._t_remove(it.Right);break}})}isButtonPressed(t){return this.pressedButtons.includes(t)}createEventArgument(t){return{isProcessed:!1,position:this.position.clone(),movement:this.movement.clone(),dragstart:this.dragstart.clone(),dragend:this.dragend.clone(),wheeldelta:this.wheeldelta,domEvent:t}}setCursor(t){this.element.style.cursor=t}}Array.prototype._t_foreach||Object.defineProperty(Array.prototype,"_t_foreach",{value:function(s){if(typeof s=="function")for(let t=0;t<this.length;t++){const e=this[t];s.call(this,t,e)}},enumerable:!1}),Array.prototype._t_remove||Object.defineProperty(Array.prototype,"_t_remove",{value:function(s){var t=this.indexOf(s);t>-1&&this.splice(t,1)},enumerable:!1}),Array.prototype._t_removeAt||Object.defineProperty(Array.prototype,"_t_removeAt",{value:function(s,t=1){this.splice(s,t)}}),Array.prototype._t_clear||Object.defineProperty(Array.prototype,"_t_clear",{value:function(){this.length=0},enumerable:!1}),Array.prototype._t_pushIfNotExist||Object.defineProperty(Array.prototype,"_t_pushIfNotExist",{value:function(s){this.includes(s)||this.push(s)},enumerable:!1}),Array.prototype._t_set||Object.defineProperty(Array.prototype,"_t_set",{value:function(s){if(arguments.length>1)for(var t=1;t<arguments.length-1;t++)this[s++]=arguments[t]},enumerable:!1}),Object.prototype._t_foreach||Object.defineProperty(Object.prototype,"_t_foreach",{value:function(s){if(this==null)throw Error("Cannot iterate over null object");const t=this||window;for(const e in t)if(t.hasOwnProperty(e)&&s.call(t,e,t[e])===!1)break},enumerable:!1});class Ri{constructor(t){if(!t)throw Error("Object to define events cannot be null or undefined");this.cstor=t;const e=Object.getPrototypeOf(t);e.__events?t.__events={...e.__events}:t.__events={}}registerEvents(){for(let t=0;t<arguments.length;t++){const e=arguments[t];this.cstor.__events[e]=null,this.setupPrototypeEventDispatcher(this.cstor,e)}}setupPrototypeEventDispatcher(t,e){const i=this,n=function(h,a){const l=this;if(h.indexOf(" ")>0){const d=h.split(" ");for(let c=0;c<d.length;c++)i.addEventListenerForObject(l,d[c],a)}else i.addEventListenerForObject(l,h,a);return a},r=function(h,a){if(typeof this._eventListeners!="object"||!this._eventListeners.hasOwnProperty(h))return;const l=this._eventListeners[h];let d;for(let c=0;c<l.length&&(d=l[c].call(this,a),!d);c++);return d},o=t.prototype;o.addEventListener=n,o.on=o.addEventListener,o.raiseEvent=r,typeof o.removeEventListener!="function"&&(o.removeEventListener=function(h,a){if(!this._eventListeners.hasOwnProperty(h)&&!function(){if(h.startsWith("on")){const l=h.substr(2);if(t.__events.hasOwnProperty(l))return console.warn("recommended to remove 'on' prefix for removing event listener: "+h),h=l,!0}return!1}()){console.warn("listener to be removed from an event which does not exist: "+h);return}this._eventListeners[h]._t_remove(a)}),Object.defineProperty(o,"on"+e,{get:function(){return function(){return r.call(this,e,...arguments)}},set:function(h){typeof this._eventListeners>"u"&&Object.defineProperty(this,"_eventListeners",{value:{},enumerable:!1}),this._eventListeners[e]=[h]},enumerable:!1})}addEventListenerForObject(t,e,i){const n=Object.getPrototypeOf(t).constructor;if(!n.__events.hasOwnProperty(e)&&!function(){if(e.startsWith("on")){const r=e.substr(2);if(n.__events.hasOwnProperty(r))return console.warn("recommended to remove 'on' prefix for adding event listener: "+e),e=r,!0}return!1}.call(this)){console.warn("event to be listened does not exist: "+e);return}typeof t._eventListeners>"u"&&Object.defineProperty(t,"_eventListeners",{value:{},enumerable:!1}),t._eventListeners.hasOwnProperty(e)||(t._eventListeners[e]=[]),t._eventListeners[e]._t_pushIfNotExist(i)}}const T={Backspace:8,Tab:9,Enter:13,Shift:16,Control:17,Alt:18,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Insert:45,Delete:46,D0:48,D1:49,D2:50,D3:51,D4:52,D5:53,D6:54,D7:55,D8:56,D9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Command_Firefox:224,Command_Opera:17,Command_Left:91,Command_Right:93,Multiply:106,Add:107,Subtract:108,Divide:111,Backquote:192},_t={Control:4096,Alt:8192,Shift:16384,Command:65536,Windows:131072},Hi=[T.Control,T.Shift,T.Alt,T.Command_Left,T.Command_Right,T.Command_Firefox,T.Command_Opera];function ki(s){return Hi.includes(s)}class Wi{constructor(t){this.controller=t,this.element=t.element,this.lastKeyCode=0,this.pressedKeys=[],this.attach()}attach(){const t=this.controller,e=this.element;e.addEventListener("keydown",i=>{this.pressedKeys._t_pushIfNotExist(i.keyCode),this.lastKeyCode=i.keyCode;const n=this.createEventArgument(i);if(n.isHotkey&&t.raise(this,"hotkey",n),n.isProcessed||t.raise(this,"keydown",n),n.isProcessed)return i.preventDefault(),!1}),e.addEventListener("keyup",i=>{this.pressedKeys._t_remove(i.keyCode),this.lastKeyCode=i.keyCode;const n=this.createEventArgument(i);if(t.raise(this,"keyup",n),n.isProcessed)return i.preventDefault(),!1}),e.addEventListener("blur",i=>{this.pressedKeys=[]}),window.addEventListener("blur",i=>{this.pressedKeys=[]})}createEventArgument(t){const e={domEvent:t,keyCode:t.keyCode,keyValue:t.keyCode};let i=!1;return t.ctrlKey&&(e.keyValue|=_t.Control,i=!0),t.altKey&&(e.keyValue|=_t.Alt,i=!0),t.shiftKey&&(e.keyValue|=_t.Shift,i=!0),t.metaKey&&(e.keyValue|=_t.Command,i=!0),i&&(ki(t.keyCode)||(e.isHotkey=!0)),e}isKeyPressed(t){return this.pressedKeys.includes(t)}}class Bi{constructor(t){this.controller=t,this.element=t.element,this.fingers=0,this.attach()}attach(){const t=this.controller,e=this.element,i=this.controller.mouseAgent;e.addEventListener("touchstart",n=>{if(typeof n.touches=="object"){const r=n.touches[0],o=e.getBoundingClientRect();i.position.x=r.clientX-o.left,i.position.y=r.clientY-o.top,i.movement.x=0,i.movement.y=0,i.dragstart.x=i.position.x,i.dragstart.y=i.position.y,t.operationMode=x.DragReady,this.fingers=n.touches.length,t.raise(this,"mousedown",this.createEventArgument(n))}},{passive:!0}),window.addEventListener("touchmove",n=>{if(typeof n.touches=="object"){const r=n.touches[0],o=e.getBoundingClientRect(),h={x:r.clientX-o.left,y:r.clientY-o.top};switch(i.movement.x=h.x-i.position.x,i.movement.y=h.y-i.position.y,i.position.x=h.x,i.position.y=h.y,t.operationMode){case x.DragReady:t.raise(this,"begindrag",this.createEventArgument(n)),n.preventDefault(),t.operationMode=x.Dragging;break;case x.Dragging:t.raise(this,"drag",this.createEventArgument(n)),n.preventDefault();break}}},{passive:!1}),window.addEventListener("touchend",n=>{n.touches?this.fingers=n.length:this.fingers=0,t.operationMode===x.Dragging?(t.raise(this,"enddrag",this.createEventArgument(n)),t.operationMode=x.None):(t.operationMode=x.None,t.raise(this,"mouseup",this.createEventArgument(n)))})}createEventArgument(t){const e=this.controller.mouseAgent.createEventArgument(t);return e.touch={fingers:this.fingers},e}}const Ni={elementId:void 0,elementInstance:void 0,disableContextMenu:!0};class j{constructor(t,e){if(this.options={...Ni,...e},this.operationMode=x.None,this.element=t,!this.element&&this.options.elementId&&(this.element=document.getElementById(this.options.elementId)),!this.element)throw"Must specify an element to receive user input.";this.mouseAgent=new Ii(this),this.keyboardAgent=new Wi(this),this.touchAgent=new Bi(this),this.currentAgent=null,this.options.disableContextMenu&&(window.oncontextmenu=i=>(i.preventDefault(),!1))}raise(t,e,i){this.currentAgent=t,this.raiseEvent(e,this.createEventArgument(i))}createEventArgument(t){const e=t||{};return e.isButtonPressed=i=>this.isButtonPressed(i),e.isKeyPressed=i=>this.isKeyPressed(i),e.controller=this,e}isButtonPressed(t){return this.mouseAgent.isButtonPressed(t)}isKeyPressed(t){return this.keyboardAgent.isKeyPressed(t)}setCursor(t){this.mouseAgent.setCursor(t)}}new Ri(j).registerEvents("mousedown","mouseup","mousemove","mouseenter","mouseout","mousewheel","keydown","keyup","hotkey","drag","begindrag","enddrag");var be={id:"time",initial:"idle",context:{},states:{idle:{onEnter(s,t){},onExit(s,t){},on:{resize:{target:"resize",action:(s,t)=>{}},xAxis_scale:{target:"scale",action:(s,t)=>{}},xAxis_inc:{target:"incremental",action:(s,t)=>{}},xAxis_log:{target:"logarithmic",action:(s,t)=>{}},xAxis_100:{target:"percentual",action:(s,t)=>{}},chart_pan:{target:"chart_pan",action:(s,t)=>{}},chart_zoom:{target:"chart_zoom",action:(s,t)=>{}}}},resize:{onEnter(s,t){},onExit(s,t){},on:{someEvent:{target:"",action:(s,t)=>{}}}},chart_pan:{onEnter(s,t){},onExit(s,t){},on:{chart_pan:{target:"chart_pan",action:(s,t)=>{}},chart_panDone:{target:"idle",action:(s,t)=>{}}}},chart_zoom:{onEnter(s,t){},onExit(s,t){},on:{always:{target:"idle",condition:"zoomDone",action:(s,t)=>{}}}}},guards:{zoomDone:(s,t,{cond:e})=>!0}};class Ui{#r="Timeline";#o="time";#t;#n;#e;#i;#s;#h;#a;#l;#d;#c;#f;#g;#u;#p;constructor(t,e){this.#t=t,this.#n=e,this.#e=t.api.elements.elTime,this.#s=t.api.MainPane,this.#h=t.api.Chart,this.#i=t.api.core,this.#a=new Ei(this,this.#h),this.init()}log(t){this.#t.log(t)}info(t){this.#t.info(t)}warning(t){this.#t.warn(t)}error(t){this.#t.error(t)}get name(){return this.#r}get shortName(){return this.#o}get mediator(){return this.#t}get options(){return this.#n}get height(){return this.#e.clientHeight}set width(t){this.setWidth(t)}get width(){return this.#e.clientWidth}get xAxis(){return this.#a}get xAxisWidth(){return this.#a.width}get xAxisRatio(){return this.#a.xAxisRatio}get layerLabels(){return this.#g}get layerOverlays(){return this.#u}get xAxisGrads(){return this.#a.xAxisGrads}get candleW(){return this.#a.candleW}get theme(){return this.#i.theme}get config(){return this.#i.config}get viewport(){return this.#c}get viewTotal(){return this.#f}get range(){return this.#i.range}get pos(){return this.dimensions}get dimensions(){return u.elementDimPos(this.#e)}get bufferPx(){return this.#i.bufferPx}get scrollPos(){return this.#i.scrollPos}get scrollOffsetPx(){return this.#i.scrollPos%this.candleW}get smoothScrollOffset(){return this.#i.smoothScrollOffset}get rangeScrollOffset(){return this.#i.rangeScrollOffset}init(){this.mount(this.#e),this.log(`${this.#r} instantiated`)}mount(t){t.innerHTML=this.defaultNode();const e=this.#t.api;this.#l=u.findBySelector(`#${e.id} .${rt} .viewport`),this.#d=u.findBySelector(`#${e.id} .${rt} .viewTotal`)}defaultNode(){return`
    <div class="viewport"></div>
    <div class="viewTotal"></div>
  `}setWidth(t){this.#e.style.width=`${t}px`,this.#l.style.width=t}setDimensions(t){const e=this.config.buffer||G,i=t.w-this.#i.Chart.scale.width,n=this.height,r=Math.round(i*((100+e)*.01));this.#c.setSize(i,this.height),this.#g.setSize(r,n),this.#u.setSize(r,n),this.#p.setSize(r,n),this.setWidth(t.w),this.draw()}start(){this.emit("started"),this.createViewport(),this.#a.initXAxisGrads(),this.draw(),this.eventsListen(),be.context.origin=this,this.#t.stateMachine=be,this.#t.stateMachine.start()}end(){}eventsListen(){let t=this.#c.scene.canvas;new j(t),this.on("main_mousemove",e=>{this.drawCursorTime(e)})}on(t,e,i){this.#t.on(t,e,i)}off(t,e){this.#t.off(t,e)}emit(t,e){this.#t.emit(t,e)}xPos(t){return this.#a.xPos(t)}xPosSnap2CandlePos(t){return this.#a.xPosSnap2CandlePos(t)}xPos2Time(t){return this.#a.xPos2Time(t)}xPos2Index(t){return this.#a.xPos2Index(t)}xPosOHLCV(t){return this.#a.xPosOHLCV(t)}createViewport(){const t=this.config.buffer||G,e=this.xAxisWidth,i=this.#e.clientHeight,n={width:Math.round(e*((100+t)*.01)),height:i};this.#c=new m.Viewport({width:e,height:i,container:this.#l}),this.#g=new m.Layer(n),this.#u=new m.Layer(n),this.#p=new m.Layer(n),this.#c.addLayer(this.#g).addLayer(this.#u).addLayer(this.#p)}draw(){this.#p.setPosition(this.scrollPos,0),this.#g.setPosition(this.scrollPos,0),this.#u.setPosition(this.scrollPos,0),this.#a.draw(),this.drawCursorTime(),this.#c.render()}drawCursorTime(){const t=this.#p.scene.context,e=this.#l.getBoundingClientRect(),i=this.#i.mousePos.x-e.left;let n=this.xPos2Time(i),r=new Date(n),o={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"},h=r.toLocaleDateString("en-GB",o),a={fontSize:H.FONTSIZE*1.05,fontWeight:H.FONTWEIGHT,fontFamily:H.FONTFAMILY,txtCol:H.COLOUR_CURSOR,bakCol:H.COLOUR_CURSOR_BG,paddingTop:5,paddingBottom:3,paddingLeft:4,paddingRight:4},l=_e(t,h,a),d=i+this.bufferPx;d=this.#a.xPosSnap2CandlePos(d),d=d-Math.round(l*.5)-this.scrollPos-this.bufferPx,this.#p.scene.clear(),t.save(),Ee(t,h,d,1,a),t.restore(),this.#c.render()}resize(t=this.width,e=this.height){this.setDimensions({w:t,h:e})}}class zi extends pe{#r;#o;#t=O[0];#n=1.04;#e=le;#i=ai;#s=3;#h=3;#a;constructor(t,e,i=O[0]){super(),this.#o=e,this.#r=t,this.yAxisType=i}get chart(){return this.#o}get data(){return this.chart.data}get range(){return this.#r.mediator.api.core.range}get height(){return this.chart.height}get rangeH(){return this.range.height*this.yAxisPadding}get yAxisRatio(){return this.height/this.range.height}get yAxisPrecision(){return this.yAxisCalcPrecision}set yAxisPadding(t){this.#n=t}get yAxisPadding(){return this.#n}set yAxisType(t){this.#t=O.includes(t)?t:O[0]}get yAxisType(){return this.#t}set yAxisStep(t){this.#e=y(t)?t:le}get yAxisStep(){return this.#e}set yAxisTicks(t){this.#h=y(t)?t:0}get yAxisTicks(){return this.#h}get yAxisGrads(){return this.#a}calcHeight(){let t=this.#o.mediator.api;return t.height-t.utilsW-t.scaleW}yAxisRangeBounds(){}yAxisLog(){}yAxisCntDigits(t){return this.countDigits(t)}yAxisCalcPrecision(){let t=this.numDigits(this.range.priceMax);return this.yDigits-t}yAxisCursor(){}yPos(t){switch(this.yAxisType){case"percent":return this.p100toPixel(t);case"log":return this.$2Pixel(fe(t));default:return this.$2Pixel(t)}}yPos2Price(t){return this.pixel2$(t)}$2Pixel(t){let e=t-this.range.priceMin;return this.height-e*this.yAxisRatio}pixel2$(t){let e=(this.height-t)/this.height,i=this.range.height*e;return this.range.priceMin+i}p100toPixel(t){return this.height*t/100}calcGradations(){switch(this.yAxisType){case"percent":this.#a=this.gradations(100,0,!1);break;default:this.#a=this.gradations(this.range.priceMax,this.range.priceMin);break}}gradations(t,e,i=!0){const n=(t+e)*.5,r=this.height*.5;let o=this.countDigits(n);const h=this.niceValue(o,i),a=[[h,W(r),o]];let l=W(me(fe(r),2)-1),d=(t-h)/l,c=r/l,g=h+d,p=r-c,L,M;for(;g<=t;)o=this.countDigits(g),L=this.niceValue(o,i),M=[L,W(p),o],a.unshift(M),g+=d,p-=c;let w=h-d;for(p=r+c;w>=e;)o=this.countDigits(w),L=this.niceValue(o,i),M=[L,W(p),o],a.push(M),w-=d,p+=c;return a}niceValue(t,e=!0){if(t.integers){let i=t.integers-this.#s;if(i>0){let n=me(10,i);return Math.floor(t.value/n)*n}else return e?(i=(i-1)*-1,W(t.value,i)):Math.floor(t.value)}else{let i=t.decimals-this.#s;return i=(i-1)*-1,W(t.value,i)}}limitPrecision(t){let e=t.value,i=this.#i-t.total,n=4-t.integers;if(i<1){let r=t.decimals+i;e=Number.parseFloat(e).toFixed(r)}else if(n<1){let r=2-n;e=Number.parseFloat(e).toFixed(r)}return e}draw(){this.calcGradations(),this.drawLabels(),this.drawOverlays()}drawLabels(){this.#r.layerLabels.scene.clear();const t=this.#a,e=this.#r.layerLabels.scene.context;e.save(),e.strokeStyle=R.COLOUR_TICK,e.fillStyle=R.COLOUR_TICK,e.font=R.FONT_LABEL;for(let i of t)e.fillText(i[0],this.yAxisTicks+5,i[1]+4),e.beginPath(),e.moveTo(0,i[1]),e.lineTo(this.yAxisTicks,i[1]),e.stroke();e.restore()}drawOverlays(){this.#r.layerOverlays.scene.clear(),this.#a;const t=this.#r.layerOverlays.scene.context;t.save(),t.restore()}}var Vi={id:"scale",initial:"idle",context:{},states:{idle:{onEnter(s,t){},onExit(s,t){},on:{resize:{target:"resize",action:(s,t)=>{}},yAxis_scale:{target:"scale",action:(s,t)=>{}},yAxis_inc:{target:"incremental",action:(s,t)=>{}},yAxis_log:{target:"logarithmic",action:(s,t)=>{}},yAxis_100:{target:"percentual",action:(s,t)=>{}},chart_pan:{target:"chart_pan",action:(s,t)=>{}},chart_zoom:{target:"chart_zoom",action:(s,t)=>{}}}},resize:{onEnter(s,t){},onExit(s,t){},on:{someEvent:{target:"",action:(s,t)=>{}}}},chart_pan:{onEnter(s,t){},onExit(s,t){},on:{chart_pan:{target:"chart_pan",action:(s,t)=>{s.context.origin.draw()}},chart_panDone:{target:"idle",action:(s,t)=>{s.context.origin.draw()}}}},chart_zoom:{onEnter(s,t){},onExit(s,t){},on:{always:{target:"idle",condition:"zoomDone",action:(s,t)=>{s.context.origin.draw()}}}}},guards:{zoomDone:(s,t,{cond:e})=>!0}};class De{#r;#o="Y Scale Axis";#t="scale";#n;#e;#i;#s;#h;#a;#l;#d;#c;#f;#g=O[0];#u;#p;#T;#y;#w;constructor(t,e){this.#n=t,this.#e=e,this.#d=t.api.elements.elScale,this.#h=t.api.core.Chart,this.#i=t.api.parent,this.#s=this.#n.api.core,this.#e=e,this.#r=this.#e.offChartID||dt("TX_scale_"),this.init()}log(t){this.#n.log(t)}info(t){this.#n.info(t)}warning(t){this.#n.warn(t)}error(t){this.#n.error(t)}get ID(){return this.#r}get name(){return this.#o}get shortName(){return this.#t}get mediator(){return this.#n}get options(){return this.#e}set height(t){this.setHeight(t)}get height(){return this.#d.clientHeight}get width(){return this.#d.clientWidth}get yAxisHeight(){return this.#l.height}get yAxisRatio(){return this.#l.yAxisRatio}get layerLabels(){return this.#p}get layerOverlays(){return this.#T}set yAxisType(t){this.#g=O.includes(t)?t:O[0]}get yAxisType(){return this.#g}get yAxisGrads(){return this.#l.yAxisGrads}get viewport(){return this.#u}get pos(){return this.dimensions}get dimensions(){return u.elementDimPos(this.#d)}get theme(){return this.#s.theme}get config(){return this.#s.config}init(){this.mount(this.#d),this.yAxisType=this.options.yAxisType,this.log(`${this.#o} instantiated`)}start(t){this.emit("started",t),this.#l=new zi(this,this,this.yAxisType),this.createViewport(),this.draw(),this.eventsListen();const e=Xt(Vi);e.context.origin=this,this.mediator.stateMachine=e,this.mediator.stateMachine.start()}end(){}eventsListen(){let t=this.#u.scene.canvas;new j(t),this.on(`${this.#i.ID}_mousemove`,e=>{this.onMouseMove(e)}),this.on(`${this.#i.ID}_mouseout`,e=>{this.eraseCursorPrice()})}on(t,e,i){this.mediator.on(t,e,i)}off(t,e){this.mediator.off(t,e)}emit(t,e){this.mediator.emit(t,e)}onResize(t){this.setDimensions(t)}onMouseMove(t){this.#w=F(t)?t:[Math.floor(t.position.x),Math.floor(t.position.y)],this.drawCursorPrice()}mount(t){t.innerHTML=this.defaultNode(),this.#f=t.querySelector(".viewport")}setHeight(t){this.#d.style.height=`${t}px`}setDimensions(t){const e=this.#d.clientWidth;this.#u.setSize(e,t.h),this.#p.setSize(e,t.h),this.#T.setSize(e,t.h),this.#y.setSize(e,t.h),this.setHeight(t.h),this.draw(void 0,!0)}defaultNode(){return this.mediator.api,`
      <div class="viewport"></div>
    `}yPos(t){return this.#l.yPos(t)}yPos2Price(t){return this.#l.yPos2Price(t)}nicePrice(t){let e=this.#l.countDigits(t);return this.#l.limitPrecision(e)}createViewport(){const t=this.#d.clientWidth,e=this.#d.clientHeight,i={width:t,height:e};this.#u=new m.Viewport({width:this.#d.clientWidth,height:this.#d.clientHeight,container:this.#f}),this.#p=new m.Layer(i),this.#T=new m.Layer(i),this.#y=new m.Layer,this.#u.addLayer(this.#p).addLayer(this.#T).addLayer(this.#y)}draw(){this.#l.draw(),this.#u.render()}drawCursorPrice(){let[t,e]=this.#w,i=this.yPos2Price(e),n=this.nicePrice(i),r={fontSize:R.FONTSIZE*1.05,fontWeight:R.FONTWEIGHT,fontFamily:R.FONTFAMILY,txtCol:R.COLOUR_CURSOR,bakCol:R.COLOUR_CURSOR_BG,paddingTop:2,paddingBottom:2,paddingLeft:3,paddingRight:3},o=r.fontSize+r.paddingTop+r.paddingBottom,h=e-o*.5;this.#y.scene.clear();const a=this.#y.scene.context;a.save(),a.fillStyle=r.bakCol,a.fillRect(1,h,this.width,o),Ee(a,`${n}`,1,h,r),a.restore(),this.#u.render()}eraseCursorPrice(){this.#y.scene.clear(),this.#u.render()}resize(t=this.width,e=this.height){this.setDimensions({w:t,h:e})}}class Oe{#r;#o;constructor(t){this.#r=t,this.#o={},this.mount(t)}get list(){return this.#o}mount(t){}defaultNode(){}buildLegend(t){const e="margin: .5em 0 1em 1em; font-size: 12px;";let i="margin-right: 1em; white-space: nowrap;";const n="display: inline; margin-left: -1em;";return i+=t?.type==="chart"?"font-size: 1.5em;":"font-size: 1.2em;",`
      <div id="${t.id}" class="legend" style="${e}">
        <span class="title" style="${i}">${t.title}</span>
        <dl style="${n}">${this.buildInputs(t)}</dl>
      </div>
    `}buildInputs(t){let e="",i,n="display: inline; margin-left: 1em;",r="display: inline; margin-left: .25em;";for(i in t.inputs)e+=`<dt style="${n}">${i}:</dt>
      <dd style="${r}">${t.inputs[i]}</dd>`;return e}add(t){if(!C(t)||!("title"in t))return!1;t.id=dt(t?.id||"legend"),t.type=t?.type||"overlay";const e=this.buildLegend(t),i=u.htmlToElement(e);return this.#r.appendChild(i),this.#o[t.id]={el:u.findByID(t.id),type:t.type},t.id}remove(t){return!(t in this.#o)||this.#o[t].type==="chart"?!1:(this.#o[t].el.remove(),delete this.#o[t],!0)}update(t,e){if(!C(e)||!(t in this.#o))return!1;const i=this.buildInputs(e),n=u.findBySelector(`#${t} dl`);n.innerHTML=i}}class Vt{#r;#o;#t;#n;#e;#i;constructor(t,e,i,n){this.#r=t,this.#o=t.scene,this.#t=n,this.#n=e,this.#e=i,this.#i=e.mediator.api.core,this.#t.axes=n.axes||"both"}draw(t){t=t||this.#t.axes,this.#o.clear();const e=this.#n.xAxisGrads.values,i=this.#o.context;if(i.save(),i.strokeStyle=Fe.COLOUR_GRID,t!="y"){const n=this.#n.smoothScrollOffset||0;for(let r of e)i.beginPath(),i.moveTo(r[1]+n,0),i.lineTo(r[1]+n,this.#o.height),i.stroke()}if(t!="x"){const n=this.#e.yAxisGrads;for(let r of n)i.beginPath(),i.moveTo(0,r[1]),i.lineTo(this.#o.width,r[1]),i.stroke()}i.restore()}}class Fi{constructor(t,e){this.scene=t,this.ctx=this.scene.context,this.width=this.scene.width,this.cfg=e,this.cfg.colourVolumeUp=this.cfg?.colourVolumeUp||$t.COLOUR_VOLUME_UP,this.cfg.colourVolumeDn=this.cfg?.colourVolumeDn||$t.COLOUR_VOLUME_DN}draw(t){const e=this.ctx,n=t.raw[4]>=t.raw[1]?this.cfg.colourVolumeUp:this.cfg.colourVolumeDn;e.save(),e.strokeStyle=n,e.fillStyle=n,e.fillRect(Math.floor(t.x),Math.floor(t.z-t.h),Math.floor(t.w),Math.floor(t.h)),e.restore()}}class Gi extends Fi{#r;#o;#t;#n;#e;#i;constructor(t,e,i,n){super(t.scene,n),this.#r=t,this.#o=t.scene,this.#t=n,this.#n=e,this.#i=e.mediator.api.core,this.#t.maxVolumeH=n?.maxVolumeH||100}draw(t=this.#i.range){this.#o.clear();const e=t.data,i=this.scene.height,n=this.#n.smoothScrollOffset||0,r={x:0+n-this.#n.candleW,w:this.#n.candleW,z:i},o=Math.floor(i*this.#t.maxVolumeH/100),h=t.volumeMax;let a=this.#n.rangeScrollOffset,l=t.indexStart-a,d=t.Length+a+1,c;for(;d;)c=t.value(l),c[4]!==null&&(r.h=o-(h-c[5])*o/h,r.raw=e[l],super.draw(r)),l++,d--,r.x=r.x+r.w}}class Xi{areaCoordinates;constructor(t,e){this.scene=t,this.ctx=this.scene.context,this.width=this.scene.width,this.cfg=e,this.cfg.candleType=this.cfg?.candleType||"CANDLE_SOLID",this.cfg.colourCandleUp=this.cfg?.colourCandleUp||gt.COLOUR_CANDLE_UP,this.cfg.colourCandleDn=this.cfg?.colourCandleDn||gt.COLOUR_CANDLE_DN,this.cfg.colourWickUp=this.cfg?.colourWickUp||gt.COLOUR_WICK_UP,this.cfg.colourWickDn=this.cfg?.colourWickDn||gt.COLOUR_WICK_DN}draw(t){const e=this.ctx,i=t.raw[4]>=t.raw[1],n=i?this.cfg.colourCandleUp:this.cfg.colourCandleDn,r=i?this.cfg.colourWickUp:this.cfg.colourWickDn;switch(this.cfg?.candleType){case"CANDLE_SOLID":this.fill=!0;break;case"CANDLE_HOLLOW":case"OHLC":this.fill=!1;break;case"CANDLE_UP_HOLLOW":this.fill=!i;break;case"CANDLE_DOWN_HOLLOW":this.fill=i}let o=Math.max(t.w-1,1),h=Math.max(Math.floor(o*.5),1),a=Math.abs(t.o-t.c),l=t.c===t.o?1:2,d=t.x+h,c=Math.floor(d)-.5;if(e.save(),e.strokeStyle=r,e.beginPath(),e.moveTo(c,Math.floor(t.h)),this.cfg.candleType==="OHLC"?e.lineTo(c,Math.floor(t.l)):i?(e.lineTo(c,Math.floor(t.c)),e.moveTo(c,Math.floor(t.o))):(e.lineTo(c,Math.floor(t.o)),e.moveTo(c,Math.floor(t.c))),e.lineTo(c,Math.floor(t.l)),e.stroke(),t.w>1.5&&this.fill){e.fillStyle=n;let g=i?1:-1;e.rect(Math.floor(d-h-1),t.c,Math.floor(h*2+1),g*Math.max(a,l)),e.fill(),e.stroke()}else if(t.w>1.5&&!this.fill&&this.cfg.candleType!=="OHLC"){let g=i?1:-1;e.rect(Math.floor(d-h-1),t.c,Math.floor(h*2+1),g*Math.max(a,l)),e.stroke()}else this.cfg.candleType==="OHLC"?(e.beginPath(),e.moveTo(c-h,t.o),e.lineTo(c,t.o),e.moveTo(c,t.c),e.lineTo(c+h,t.c),e.stroke()):(e.strokeStyle=n,e.beginPath(),e.moveTo(c,Math.floor(Math.min(t.o,t.c))),e.lineTo(c,Math.floor(Math.max(t.o,t.c))+(t.o===t.c?1:0)),e.stroke());e.restore()}body(t){}area(t){this.areaCoordinates.push(t)}areaRender(){ctx.save(),ctx.beginPath();let t=this.areaCoordinates;for(let e=0;e<t.length;e++)this.ctx,t[e].raw[4]>=data[e+1].raw[4];ctx.restore()}}class Yi extends Xi{#r;#o;#t;#n;#e;#i;constructor(t,e,i,n){super(t.scene,n),this.#r=t,this.#o=t.scene,this.#t=n,this.#n=e,this.#e=i,this.#i=e.mediator.api.core}get target(){return this.#r}draw(t=this.#i.range){this.#o.clear();const e=this.#t.CandleType==="AREA"?l=>{}:l=>{super.draw(l)},i=this.#n.smoothScrollOffset||0,n={x:2+i-this.#n.candleW,w:this.#n.candleW};let r=this.#n.rangeScrollOffset,o=t.indexStart-r,h=t.Length+r+2,a;for(;h;)a=t.value(o),a[4]!==null&&(n.o=this.#e.yPos(a[1]),n.h=this.#e.yPos(a[2]),n.l=this.#e.yPos(a[3]),n.c=this.#e.yPos(a[4]),n.raw=a,e(n)),o++,h--,n.x=n.x+n.w;this.#t.CandleType==="AREA"&&super.areaRender()}}class Ae{#r;#o;#t;#n;#e;#i;#s=[0,0];constructor(t,e,i,n,r){this.#r=t,this.#o=t.scene,this.#t=r,this.#n=e,this.#e=i,this.#i=n,this.#n.on("chart_pan",o=>{this.onMouseDragX(o)}),this.#n.on("chart_panDone",o=>{this.onMouseDragX(o)}),this.#n.on("main_mousemove",o=>{this.onMouseMoveX(o)}),this.#n.on(`${this.#n.ID}_mousemove`,o=>{this.onMouseMoveY(o)})}onMouseDragX(t){this.#s[0]=t[0],this.draw(!0)}onMouseMoveX(t){this.#s[0]=t[0],this.draw()}onMouseMoveY(t){this.#s[1]=t[1],this.draw()}draw(t=!1){let e=this.#s[0];t||(e=this.#e.xPosSnap2CandlePos(e)+this.#e.scrollOffsetPx);let i=this.#s[1];this.#o.clear();const n=this.#o.context;n.save(),n.setLineDash([5,5]);const r=this.#e.smoothScrollOffset||0;n.strokeStyle="#666",n.beginPath(),n.moveTo(e+r,0),n.lineTo(e+r,this.#o.height),n.stroke(),this.#n.cursorActive&&(n.beginPath(),n.moveTo(0,i),n.lineTo(this.#o.width,i),n.stroke()),n.restore(),this.#r.viewport.render()}}var $e={id:"chart",initial:"idle",context:{},states:{idle:{onEnter(s,t){s.context.origin.setCursor("crosshair")},onExit(s,t){},on:{chart_pan:{target:"chart_pan",action:(s,t)=>{s.context.origin.setCursor("grab")}},chart_tool:{target:"chart_tool",action:(s,t)=>{}},chart_zoom:{target:"chart_zoom",action:(s,t)=>{}},xAxis_scale:{target:"xAxis_scale",action:(s,t)=>{}}}},chart_pan:{onEnter(s,t){},onExit(s,t){},on:{chart_pan:{target:"chart_pan",action:(s,t)=>{s.context.origin.updateRange(t)}},chart_panDone:{target:"idle",action:(s,t)=>{s.context.origin.updateRange(t)}}}},chart_zoom:{onEnter(s,t){},onExit(s,t){},on:{always:{target:"idle",condition:"zoomDone",action:(s,t)=>{s.context.origin.zoomRange(t)}}}},xAxis_scale:{onEnter(s,t){},onExit(s,t){},on:{Idle:{target:"idle",action:(s,t)=>{}}}}},guards:{zoomDone:(s,t,{cond:e})=>!0}};const ji="",Ki="position: absolute; top: 0; right: 0; border-left: 1px solid;";class Zi{#r="Chart";#o="chart";#t;#n;#e;#i;#s;#h;#a;#l;#d;#c;#f;#g;#u;#p=5;#T=2.5;#y;#w;#S;#m;#_;#E;#M;#v;#D;#L;#x;#b;#A;#$;#O;#C=[0,0];#k=!1;#P;#W;#I;#R;#H;constructor(t,e){this.#t=t,this.#s=t.api.elements.elChart,this.#i={...this.#t.api.parent},this.#e=this.#t.api.core,this.#u=this.#t.api.onChart,this.#P=this.#t.api.settings,this.#n=e,this.init(e)}log(t){this.#t.log(t)}info(t){this.#t.info(t)}warning(t){this.#t.warn(t)}error(t){this.#t.error(t)}get ID(){return"chart"}get name(){return this.#r}get shortName(){return this.#o}get mediator(){return this.#t}get options(){return this.#n}get element(){return this.#s}get scale(){return this.#c}get elScale(){return this.#d}set width(t){this.setWidth(t)}get width(){return this.#s.clientWidth}set height(t){this.setHeight(t)}get height(){return this.#s.clientHeight}get pos(){return this.dimensions}get dimensions(){return u.elementDimPos(this.#s)}set state(t){this.#e.setState(t)}get state(){return this.#e.getState()}get data(){return this.#e.chartData}get range(){return this.#e.range}get onChart(){return this.#u}set priceDigits(t){this.setYAxisDigits(t)}get priceDigits(){return this.#y||PRICEDIGITS}get cursorPos(){return this.#C}get cursorActive(){return this.#k}get candleW(){return this.#e.Timeline.candleW}get theme(){return this.#e.theme}get config(){return this.#e.config}get scrollPos(){return this.#e.scrollPos}get bufferPx(){return this.#e.bufferPx}init(t){if(C(t))for(const n in t)n in this.props()&&this.props()[n](t[n]);this.mount(this.#s);let e={id:"chart",title:this.#I,type:"chart"};this.#g=new Oe(this.#l),this.#g.add(e);const i={...this.#t.api};i.parent=this,i.chart=this,i.elements={...i.elements,elScale:this.#d},i.onChart=this.#t.api.onChart,i.legends=this.#g,t.yAxisType="default",this.#c=this.#t.register("Chart_ScaleBar",De,t,i),window.tradex_chart_scale=this.#c,this.log(`${this.#r} instantiated`)}start(){this.#f=this.mediator.api.Timeline,this.#c.on("started",t=>{this.log(`Chart scale started: ${t}`)}),this.#c.start('Chart says to Scale, "Thanks for the update!"'),this.createViewport(),this.draw(this.range),this.setCursor("crosshair"),this.eventsListen(),$e.context.origin=this,this.#t.stateMachine=$e,this.#t.stateMachine.start()}end(){this.#H.removeEventListener("mousemove",this.onMouseMove),this.#H.removeEventListener("mouseenter",this.onMouseEnter),this.#H.removeEventListener("mouseout",this.onMouseOut),this.off("main_mousemove",this.onMouseMove)}eventsListen(){this.#H=new j(this.#h),this.#H.on("mousemove",this.onMouseMove.bind(this)),this.#H.on("mouseenter",this.onMouseEnter.bind(this)),this.#H.on("mouseout",this.onMouseOut.bind(this)),this.on("main_mousemove",t=>this.updateLegends(t))}on(t,e,i){this.#t.on(t,e,i)}off(t,e){this.#t.off(t,e)}emit(t,e){this.#t.emit(t,e)}onMouseWheel(t){const e=Math.sign(t.wheeldelta),i=this.range,n=i.indexStart-Math.floor(e*XAXIS_ZOOM*i.Length),r=i.indexEnd+Math.floor(e*XAXIS_ZOOM*i.Length),o=i.indexStart,h=i.indexEnd,a=i?"out":"in";this.emit("setRange",[n,r,o,h]),this.emit("chart_zoom",[n,r,o,h,a]),this.emit(`chart_zoom_${a}`,[n,r,o,h])}onMouseMove(t){this.#C=[Math.floor(t.position.x),Math.floor(t.position.y)],this.emit("chart_mousemove",this.#C),this.updateLegends()}onMouseEnter(t){this.#k=!0,this.#C=[Math.floor(t.position.x),Math.floor(t.position.y)],this.emit(`${this.ID}_mouseenter`,this.#C)}onMouseOut(t){this.#k=!1,this.#C=[Math.floor(t.position.x),Math.floor(t.position.y)],this.emit(`${this.ID}_mouseout`,this.#C)}mount(t){t.innerHTML=this.defaultNode();const e=this.#t.api;this.#a=u.findBySelector(`#${e.id} .${ot} .viewport`),this.#l=u.findBySelector(`#${e.id} .${ot} .legends`),this.#d=u.findBySelector(`#${e.id} .${ot} .${pt}`)}props(){return{title:t=>this.#I=t,yAxisDigits:t=>this.setYAxisDigits(t),theme:t=>this.setTheme(t)}}setWidth(t){y(t)||(t=this.width||this.#i.width),this.#s.style.width=`${t}px`,this.#a.style.width=`${t-this.#d.clientWidth}px`}setHeight(t){y(t)||(t=this.height||this.#i.height),this.#s.style.height=`${t}px`,this.#d.style.height=`${t}px`,this.#a.style.height=`${t}px`,this.#c.setDimensions({w:null,h:t})}setDimensions(t){const e=this.config.buffer||G,i=t.w-this.#d.clientWidth,n=t.h,r=Math.round(i*((100+e)*.01));this.#m.setSize(i,n),this.#E.setSize(r,n),this.#M.setSize(r,n),this.#v.setSize(r,n),this.#D.setSize(i,n),this.setWidth(t.w),this.setHeight(t.h),this.#c.resize(t.w,t.h),this.draw(void 0,!0)}setTheme(t){this.#R=t}setYAxisDigits(t){this.#y=y(t)&&t>=3?parseInt(t):PRICEDIGITS}getPriceDigits(){return this.#y}setCursor(t){this.#s.style.cursor=t}defaultNode(){const t=this.#t.api,e=t.height-t.utilsW-t.timeH,i=t.width-t.toolsW-t.scaleW,n=this.#n.chartH||e-1,r=ji+` width: ${i}px; height: ${n}px`,o=Ki+` width: ${t.scaleW-1}px; height: ${n}px; border-color: ${t.chartBorderColour};`;return`
      <div class="viewport" style="${r}"></div>
      <div class="legends" style="position: absolute; top: 0; left: 0; z-index:100;"></div>
      <div class="${pt}" style="${o}"></div>
    `}setTimezone(t){}getTimezone(t){}loadData(t){}updateData(t){}createViewport(){const t=this.config.buffer||G,e=this.#a.clientWidth,i=this.#n.chartH||this.#i.rowsH-1,n={width:Math.round(e*((100+t)*.01)),height:i};this.#m=new m.Viewport({width:e,height:i,container:this.#a}),this.#h=this.#m.scene.canvas,this.#E=new m.Layer(n),this.#M=new m.Layer(n),this.#L=this.layersOnChart(n),this.#v=new m.Layer(n),this.#D=new m.Layer,this.#m.addLayer(this.#E).addLayer(this.#M),this.addLayersOnChart(),this.#m.addLayer(this.#v).addLayer(this.#D),this.#O=new Ae(this.#D,this,this.#f,this.#c,this.#R),this.#$=new Yi(this.#v,this.#f,this.#c,this.#R),this.#R.maxVolumeH=this.#R?.onchartVolumeH||$t.ONCHART_VOLUME_HEIGHT,this.#b=new Gi(this.#M,this.#f,this.#c,this.#R),this.#x=new Vt(this.#E,this.#f,this.#c,this.#R)}layersOnChart(){let t=[];for(let e=0;e<this.#u.length;e++)t[e]=new m.Layer;return t}addLayersOnChart(){for(let t=0;t<this.#L.length;t++)this.#m.addLayer(this.#L[t])}chartIndicators(){const t=[];for(let e=0;e<this.#L.length;e++)t[e]=new kt(this.#L[e],this.#f,this.#c,this.config);return t}draw(t=this.range,e=!1){this.#E.setPosition(this.#e.scrollPos,0),this.#M.setPosition(this.#e.scrollPos,0),this.#v.setPosition(this.#e.scrollPos,0),(this.scrollPos==this.bufferPx*-1||this.scrollPos==0||e==!0)&&(this.#x.draw("y"),this.#b.draw(t),this.#$.draw(t)),this.#m.render()}time2XPos(t){return this.#f.xPos(t)}price2YPos(t){return this.#c.yPos(t)}setPriceVolumePrecision(t){if(!y(t)||t<0){this.warning("setPriceVolumePrecision","pricePrecision","pricePrecision must be a number and greater than zero!!!");return}this.#w=t}setPriceVolumePrecision(t){if(!y(t)||t<0){logWarn("setPriceVolumePrecision","volumePrecision","volumePrecision must be a number and greater than zero!!!");return}this.#S=t}updateLegends(t=this.#C){const e=this.#g.list,i=this.#f.xPosOHLCV(t[0]),n={};n.O=this.#c.nicePrice(i[1]),n.H=this.#c.nicePrice(i[2]),n.L=this.#c.nicePrice(i[3]),n.C=this.#c.nicePrice(i[4]),n.V=this.#c.nicePrice(i[5]);for(const r in e)this.#g.update(r,{inputs:n})}updateRange(t){this.#e.updateRange(t),this.draw(this.range)}zoomRange(t){this.#e.setRange(t[0],t[1]),this.draw(this.range,!0),this.emit("chart_zoomDone")}resize(t=this.width,e=this.height){this.setDimensions({w:t,h:e})}}var Pe={id:"offChart",initial:"idle",context:{},states:{idle:{onEnter(s,t){s.context.origin.setCursor("crosshair")},onExit(s,t){},on:{chart_pan:{target:"chart_pan",action:(s,t)=>{s.context.origin.setCursor("grab")}},chart_zoom:{target:"chart_zoom",action:(s,t)=>{}},chart_tool:{target:"chart_tool",action:(s,t)=>{}},xAxis_scale:{target:"xAxis_scale",action:(s,t)=>{}},offChart_mouseDown:{target:"offChart_mouseDown",action:(s,t)=>{}},offChart_mouseUp:{target:"offChart_mouseUp",action:(s,t)=>{}}}},chart_pan:{onEnter(s,t){},onExit(s,t){},on:{chart_pan:{target:"chart_pan",action:(s,t)=>{s.context.origin.updateRange(t)}},chart_panDone:{target:"idle",action:(s,t)=>{s.context.origin.updateRange(t)}}}},chart_zoom:{onEnter(s,t){},onExit(s,t){},on:{always:{target:"idle",condition:"zoomDone",action:(s,t)=>{s.context.origin.range,s.context.origin.zoomRange()}}}},xAxis_scale:{onEnter(s,t){},onExit(s,t){},on:{Idle:{target:"idle",action:(s,t)=>{}}}},offChart_mouseDown:{onEnter(s,t){},onExit(s,t){},on:{Idle:{target:"idle",action:(s,t)=>{}}}},offChart_mouseUp:{onEnter(s,t){},onExit(s,t){},on:{Idle:{target:"idle",action:(s,t)=>{}}}}},guards:{zoomDone:(s,t,{cond:e})=>!0}};const qi="",Ji="position: absolute; top: 0; right: 0; border-left: 1px solid;";class Qi{#r;#o="OffChart";#t="offChart";#n;#e;#i;#s;#h;#a;#l;#d;#c;#f;#g;#u;#p;#T;#y;#w;#S;#m;#_;#E;#M;#v;#D;#L=[0,0];#x=!1;#b;#A;#$;#O;#C;constructor(t,e){this.#n=t,this.#h=t.api.elements.elOffChart,this.#s={...this.mediator.api.parent},this.#p=e.offChart,this.#i=this.mediator.api.core,this.#e=e,this.#r=this.#e.offChartID||dt("TX_OC_"),this.init(e)}log(t){this.mediator.log(t)}info(t){this.mediator.info(t)}warning(t){this.mediator.warn(t)}error(t){this.mediator.error(t)}get ID(){return this.#r}get name(){return this.#o}get shortName(){return this.#t}get mediator(){return this.#n}get options(){return this.#e}get core(){return this.#i}get range(){return this.#i.range}get pos(){return this.dimensions}get dimensions(){return u.elementDimPos(this.#h)}get elOffChart(){return this.#h}get element(){return this.#h}get widgets(){return this.#i.WidgetsG}get offChartID(){return this.#T}get cursorPos(){return this.#L}get cursorActive(){return this.#x}get candleW(){return this.#i.Timeline.candleW}get theme(){return this.#i.theme}get config(){return this.#i.config}get scrollPos(){return this.#i.scrollPos}get bufferPx(){return this.#i.bufferPx}get Divider(){return this.#y}get width(){return this.#h.clientWidth}set width(t){this.setWidth(t)}get height(){return this.#h.clientHeight}set height(t){this.setHeight(t)}init(t){if(C(t))for(const r in t)r in this.props()&&this.props()[r](t[r]);this.mount(this.#h);let e={id:t.offChart.type,title:t.offChart.name,type:t.offChart.type};this.#g=new Oe(this.#l),this.#g.add(e);const i={...this.mediator.api};i.parent=this,i.elements.elScale=this.#d,this.#u=this.#n.api.indicators[this.#p.type].ind,t.yAxisType=this.#u.scale;const n=t.offChart.type+"_ScaleBar";this.#c=this.mediator.register(n,De,t,i),this.#f=this.core.Timeline}start(t){this.#T=t,this.#f=this.mediator.api.Timeline,this.#c.on("started",i=>{this.log(`OffChart scale started: ${i}`)}),this.#c.start("OffChart",this.name,"yAxis Scale started");const e={offChart:this};this.#y=this.widgets.insert("Divider",e),this.#y.start(),this.createViewport(),this.draw(this.range),this.setCursor("crosshair"),this.eventsListen(),Pe.context.origin=this,this.mediator.stateMachine=Pe,this.mediator.stateMachine.start()}end(){this.#C.removeEventListener("mousemove",this.onMouseMove),this.#C.removeEventListener("mouseenter",this.onMouseEnter),this.#C.removeEventListener("mouseout",this.onMouseOut),this.off("main_mousemove",this.onMouseMove)}eventsListen(){this.#C=new j(this.#h),this.#C.on("mousemove",this.onMouseMove.bind(this)),this.#C.on("mouseenter",this.onMouseEnter.bind(this)),this.#C.on("mouseout",this.onMouseOut.bind(this)),this.on("main_mousemove",this.updateLegends.bind(this))}on(t,e,i){this.mediator.on(t,e,i)}off(t,e){this.mediator.off(t,e)}emit(t,e){this.mediator.emit(t,e)}onMouseMove(t){this.#L=[Math.floor(t.position.x),Math.floor(t.position.y)],this.emit(`${this.ID}_mousemove`,this.#L),this.updateLegends()}onMouseEnter(t){this.#x=!0,this.#L=[Math.floor(t.position.x),Math.floor(t.position.y)],this.emit(`${this.ID}_mouseenter`,this.#L)}onMouseOut(t){this.#x=!1,this.#L=[Math.floor(t.position.x),Math.floor(t.position.y)],this.emit(`${this.ID}_mouseout`,this.#L)}onMouseDown(t){console.log(`${this.ID}_mousedown`)}onMouseUp(t){console.log(`${this.ID}_mouseup`)}mount(t){t.id=this.#r,t.innerHTML=this.defaultNode(),this.mediator.api,this.#a=u.findBySelector(`#${this.#r} .viewport`),this.#l=u.findBySelector(`#${this.#r} .legends`),this.#d=u.findBySelector(`#${this.#r} .${pt}`)}props(){return{title:t=>this.#$=t,yAxisDigits:t=>this.setYAxisDigits(t),theme:t=>this.setTheme(t)}}setWidth(t){y(t)||(t=this.width||this.#s.width),this.#h.style.width=`${t}px`,this.#a.style.width=`${t-this.#d.clientWidth}px`}setHeight(t){y(t)||(t=this.height||this.#s.height),this.#h.style.height=`${t}px`,this.#d.style.height=`${t}px`,this.#a.style.height=`${t}px`,this.#c.setDimensions({w:null,h:t})}setDimensions(t){const e=this.config.buffer||G,i=t.w-this.#d.clientWidth,n=t.h,r=Math.round(i*((100+e)*.01));this.#w.setSize(i,t.h),this.#m.setSize(r,n),this.#E.setSize(r,n),this.#_.setSize(i,n),this.setWidth(t.w),this.setHeight(t.h),this.#c.resize(t.w,t.h),this.draw(void 0,!0)}setTheme(t){this.#O=t}setCursor(t){this.#h.style.cursor=t}defaultNode(){const t=this.mediator.api,e=t.width-t.toolsW-t.scaleW,i=this.#e.rowH,n=qi+` width: ${e}px; height: ${i}px`,r=Ji+` width: ${t.scaleW-1}px; height: ${i}px; border-color: ${t.chartBorderColour};`;return`
      <div class="viewport" style="${n}"></div>
      <div class="legends" style="position: absolute; top: 0; left: 0; z-index:100;"></div>
      <div class="${pt}" style="${r}"></div>
    `}createViewport(){const t=this.config.buffer||G,e=this.#a.clientWidth,i=this.#e.rowH||this.#s.rowsH-1,n={width:Math.round(e*((100+t)*.01)),height:i};this.#w=new m.Viewport({width:e,height:i,container:this.#a}),this.#m=new m.Layer(n),this.#E=this.layersOnRow(n),this.#_=new m.Layer,this.#w.addLayer(this.#m).addLayer(this.#E).addLayer(this.#_),this.#D=new Ae(this.#_,this,this.#f,this.#c,this.#O),this.#v=new this.#u(this.#E,this.#p,this.#f,this.#c,this.#O),this.#M=new Vt(this.#m,this.#f,this.#c,this.#O)}layersOnRow(t){return new m.Layer(t)}addLayersOnChart(){this.#w.addLayer(this.#E)}draw(t=this.range,e=!1){this.#m.setPosition(this.#i.scrollPos,0),this.#E.setPosition(this.#i.scrollPos,0),(this.scrollPos==this.bufferPx*-1||this.scrollPos==0||e==!0)&&(this.#M.draw("y"),this.#v.draw(t)),this.#w.render()}updateLegends(t=this.#L){const e=this.#g.list,i=this.#f.xPos2Index(t[0]),n=this.range.data.length-this.#v.overlay.data.length,r=this.#v.overlay.data[i-n];if(r!==void 0){const o={};for(let h=0;h<this.#v.plots.length;h++){let a=this.#v.plots[h];o[a.key]=this.#c.nicePrice(r[h+1])}for(const h in e)this.#g.update(h,{inputs:o})}}updateRange(t){this.draw(this.range)}zoomRange(t){this.draw(this.range,!0)}resize(t=this.width,e=this.height){this.setDimensions({w:t,h:e})}}var Ie={id:"main",initial:"idle",context:{},states:{idle:{onEnter(s,t){},onExit(s,t){},on:{addIndicator:{target:"addIndicator",action:(s,t)=>{}},divider_mousedown:{target:"divider_mousedown",action:(s,t)=>{}},resize:{target:"resize",action:(s,t)=>{}}}},addIndicator:{onEnter(s,t){s.context.origin.addIndicator(t)},onExit(s,t){},on:{addIndicatorDone:{target:"idle",action:(s,t)=>{}}}},divider_mousedown:{onEnter(s,t){console.log(`${s.id}: state: "${s.state}" - onEnter`),s.context.divider=t},onExit(s,t){console.log(`${s.id}: state: "${s.state}" - onExit (${s.event})`)},on:{main_mousemove:{target:"divider_mousemove",action:(s,t)=>{console.log(`${s.id}: transition from "${s.state}" to "ilde"`)}},main_mouseup:{target:"idle",action:(s,t)=>{console.log(`${s.id}: transition from "${s.state}" to "ilde"`)}}}},divider_mousemove:{onEnter(s,t){console.log(`${s.id}: state: "${s.state}" - onEnter`);let e=s.context.divider;s.context.pair=s.context.origin.resizeRowPair(e,t)},onExit(s,t){console.log(`${s.id}: state: "${s.state}" - onExit (${s.event})`)},on:{main_mousemove:{target:"divider_mousemove",action:(s,t)=>{console.log(`${s.id}: transition from "${s.state}" to "ilde"`)}},main_mouseup:{target:"idle",action:(s,t)=>{s.actions.removeProperty(s),console.log(`${s.id}: transition from "${s.state}" to "ilde"`)}},divider_mouseup:{target:"idle",action:(s,t)=>{s.actions.removeProperty(s),console.log(`${s.id}: transition from "${s.state}" to "ilde"`)}}}},resize:{onEnter(s,t){console.log(`${s.id}: state: "${s.state}" - onEnter`),s.context.origin.setDimensions(t)},onExit(s,t){console.log(`${s.id}: state: "${s.state}" - onExit (${s.event})`)},on:{always:{target:"idle",condition:"resizeDone",action:(s,t)=>{}}}}},guards:{resizeDone:(s,t,{cond:e})=>!0},actions:{removeProperty:s=>{let t=s.context.pair.active,e=s.context.pair.prev;t.element.style.removeProperty("user-select"),e.element.style.removeProperty("user-select")}}};const ts="width:100%; min-width:100%;",es="position: relative; overflow: hidden;",is="border-top: 1px solid; width:100%; min-width:100%;",ss="border-left: 1px solid;";class ns{#r="Utilities";#o="Main";#t;#n;#e;#i;#s;#h;#a;#l;#d=[];#c;#f;#g;#u;#p;#T;#y=new Map;#w;#S;#m;#_=de;#E=120;#M=ce;#v=[0,0];#D;#L;#x;constructor(t,e){this.#t=t,this.#n=e,this.#s=t.api.elements.elMain,this.#e={...this.#t.api.parent},this.#i=this.#t.api.core,this.init(e)}log(t){this.#t.log(t)}info(t){this.#t.info(t)}warning(t){this.#t.warn(t)}error(t){this.#t.error(t)}get name(){return this.#r}get shortName(){return this.#o}get mediator(){return this.#t}get chart(){return this.#w}get time(){return this.#S}get options(){return this.#n}get width(){return this.#s.clientWidth}get height(){return this.#s.clientHeight}get chartW(){return this.#l.clientWidth}get chartH(){return this.#l.clientHeight}get rowsW(){return this.#h.clientWidth}get rowsH(){return this.#h.clientHeight}get rowMinH(){return this.#M}set rowMinH(t){y(t)&&(this.#M=Math.abs(t))}get pos(){return this.dimensions}get dimensions(){return u.elementDimPos(this.#s)}get range(){return this.#i.range}get cursorPos(){return this.#v}get candleW(){return this.#S.candleW}get theme(){return this.#i.theme}get config(){return this.#i.config}get buffer(){return this.#D}get bufferPx(){return this.getBufferPx()}get scrollPos(){return this.#i.scrollPos}init(t){this.mount(this.#s),this.#L=this.#i.indicators;const e=this.#t.api;this.#h=u.findBySelector(`#${e.id} .${It}`),this.#a=u.findBySelector(`#${e.id} .${rt}`),this.#l=u.findBySelector(`#${e.id} .${ot}`),this.#c=u.findBySelector(`#${e.id} .${Rt}`),this.#g=u.findBySelector(`#${e.id} .${Rt} .viewport`),e.parent=this,e.chartData=this.mediator.api.chartData,e.onChart=this.#t.api.onChart,e.offChart=this.#t.api.offChart,e.rangeLimit=this.#t.api.rangeLimit,e.settings=this.#t.api.settings,e.elements={...e.elements,elChart:this.#l,elTime:this.#a,elRows:this.#h,elOffCharts:this.#d},this.#S=this.#t.register("Timeline",Ui,t,e),this.registerOffCharts(t,e),this.#w=this.#t.register("Chart",Zi,t,e),this.#D=y(this.config.buffer)?this.config.buffer:G,this.#M=y(this.config.rowMinH)?this.config.rowMinH:ce,this.#_=y(this.config.offChartDefaultH)?this.config.offChartDefaultH:de,this.log(`${this.#r} instantiated`)}start(){this.#S.start(),this.#w.start();let t=0;this.#y.forEach((e,i)=>{e.start(t++)}),this.createViewport(),this.initXGrid(),this.eventsListen(),Ie.context.origin=this,this.#t.stateMachine=Ie,this.#t.stateMachine.start()}end(){this.#x.removeEventListener("mousewheel",this.onMouseWheel),this.#x.removeEventListener("mousemove",this.onMouseMove),this.#x.removeEventListener("drag",this.onChartDrag),this.#x.removeEventListener("enddrag",this.onChartDragDone),this.#x.removeEventListener("keydown",this.onChartKeyDown),this.#x.removeEventListener("keyup",this.onChartKeyDown)}eventsListen(){this.#s.tabIndex=0,this.#s.focus(),this.#x=new j(this.#s),this.#x.on("mousewheel",this.onMouseWheel.bind(this)),this.#x.on("mousemove",this.onMouseMove.bind(this)),this.#x.on("drag",this.onChartDrag.bind(this)),this.#x.on("enddrag",this.onChartDragDone.bind(this)),this.#x.on("keydown",this.onChartKeyDown.bind(this)),this.#x.on("keyup",this.onChartKeyUp.bind(this)),this.#x.on("mouseup",this.onMouseUp.bind(this))}on(t,e,i){this.#t.on(t,e,i)}off(t,e){this.#t.off(t,e)}emit(t,e){this.#t.emit(t,e)}onMouseWheel(t){t.domEvent.preventDefault();const e=Math.sign(t.wheeldelta),i=this.range,n=i.indexStart-Math.floor(e*ae*i.Length),r=i.indexEnd+Math.floor(e*ae*i.Length),o=i.indexStart,h=i.indexEnd,a=i?"out":"in";this.emit("setRange",[n,r,o,h]),this.emit("chart_zoom",[n,r,o,h,a]),this.emit(`chart_zoom_${a}`,[n,r,o,h]),this.draw()}onMouseMove(t){this.#v=[t.position.x,t.position.y,t.dragstart.x,t.dragstart.y,t.movement.x,t.movement.y],this.emit("main_mousemove",this.#v)}onMouseUp(t){this.emit("main_mouseup",t)}onChartDrag(t){this.#v=[t.position.x,t.position.y,t.dragstart.x,t.dragstart.y,t.movement.x,t.movement.y],this.emit("chart_pan",this.#v),this.draw()}onChartDragDone(t){this.#v=[t.position.x,t.position.y,t.dragstart.x,t.dragstart.y,t.movement.x,t.movement.y],this.emit("chart_panDone",this.#v),this.draw()}onChartKeyDown(t){let e=this.candleW||1;switch(t.keyCode){case T.Left:this.emit("chart_pan",[0,null,e,null,e*-1]);break;case T.Right:this.emit("chart_pan",[e,null,0,null,e]);break}this.draw()}onChartKeyUp(t){let e=this.candleW||1;switch(t.keyCode){case T.Left:this.emit("chart_panDone",[0,null,e,null,e*-1]);break;case T.Right:this.emit("chart_panDone",[e,null,0,null,e]);break}this.draw()}mount(t){t.innerHTML=this.defaultNode()}setWidth(t){const e=this.rowsW/t;this.#h.children,this.#h.style.width=`${Math.round(t*e)}px`}setHeight(t){const e=this.#t.api,i=this.rowsH/(t-e.timeH);this.#h.children,this.#h.style.height=`${Math.round(this.#h.style.height*i)}px`}setDimensions(t){let e=t.mainH-this.#S.height;this.height;let i=t.mainW,n=Math.round(this.#w.height*t.resizeH)-this.time.height,r=i-this.#w.scale.width;this.setWidth(t.mainW),this.setHeight(t.mainH),this.#i.scrollPos=-1,this.#S.setDimensions({w:t.mainW}),this.#S.draw(),this.#c.style.height=`${e}px`,this.#c.style.width=`${r}px`,this.#g.style.height=`${e}px`,this.#g.style.width=`${r}px`,this.#u.setSize(r,e);const o=this.buffer;r=Math.round(r*((100+o)*.01)),this.#p.setSize(r,e),this.#m.draw("x"),this.#u.render(),this.#w.resize(i,n),this.#y.forEach((h,a)=>{n=Math.round(h.height*t.resizeH),h.resize(i,n),h.Divider.setDividerPos()}),this.#i.range,t.rowsW=this.rowsW,t.rowsH=this.rowsH,this.emit("rowsResize",t)}getBufferPx(){let t=Math.round(this.width*this.buffer/100),e=t%this.candleW;return t-Math.round(e)}registerOffCharts(t,e){let i=this.#_*this.#t.api.offChart.length,n=Math.round(i/Math.log10(i*2))/100,r=this.rowsH*n;this.#t.api.offChart.length===1?(t.rowH=this.rowsH*this.#_/100,t.chartH=this.rowsH-t.rowH):(t.rowH=r/this.#y.size,t.chartH=this.rowsH-r);for(let o of this.#t.api.offChart)this.addOffChart(o,t,e)}addOffChart(t,e,i){this.#h.lastElementChild.insertAdjacentHTML("afterend",this.rowNode(t.type)),this.#d.push(this.#h.lastElementChild),i.elements.elOffChart=this.#h.lastElementChild,e.offChart=t;let n=this.#t.register("OffChart",Qi,e,i);this.#y.set(n.ID,n),this.emit("addOffChart",n)}addIndicator(t){console.log(`Add the ${t.target} indicator`);const e=this.#L[t.target].ind;console.log("indicator:",e),this.emit("addIndicatorDone",e)}defaultNode(){const t=this.#t.api,e=ts+`height: calc(100% - ${t.timeH}px)`,i=is+` height: ${t.timeH}px; border-color: ${t.chartBorderColour};`,n=this.defaultRowNode();return`
    <div class="${It}" style="${e}">
      ${n}
    </div>
    <div class="${rt}" style="${i}">
      <canvas id=""><canvas/>
    </div>
    `}defaultRowNode(){const t=this.#t.api,e=t.width-t.toolsW-t.scaleW,i=t.height-t.utilsH-t.timeH,n=` width: ${e}px; height: ${i}px; overflow: hidden`;let r=`<div class="${Rt}" style="position: absolute;">
                      <div class="viewport" style="${n}"></div>
                  </div>`;return r+=this.rowNode(ot),r}rowNode(t){const e=this.#t.api,i=es+` border-top: 1px solid ${e.chartBorderColour};`,n=ss+` border-color: ${e.chartBorderColour};`;return`
      <div class="${Xe} ${t}" style="${i}">
        <canvas><canvas/>
        <div class="${n}">
          <canvas id=""><canvas/>
        </div>
      </div>
    `}createViewport(){const t=this.buffer,e=this.width,i=this.rowsH,n={width:Math.round(e*((100+t)*.01)),height:i};this.#u=new m.Viewport({width:e,height:i,container:this.#g}),this.#f=this.#u.scene.canvas,this.#T=new m.Layer(n),this.#p=new m.Layer(n),this.#u.addLayer(this.#T).addLayer(this.#p);const r={...this.theme,axes:"x"};this.#m=new Vt(this.#p,this.#S,null,r)}initXGrid(){this.#p.setPosition(this.scrollPos,0),this.#m.draw("x"),this.#u.render(),this.#S.draw()}draw(){this.#p.setPosition(this.scrollPos,0),this.#m.draw("x"),this.#u.render(),this.#S.draw()}updateRange(){this.draw()}zoomRange(){this.draw()}resizeRowPair(t,e){let i=t.offChart,n=i.ID,r=Object.keys(this.#y),o=r.indexOf(n)-1,h=o>0?this.#y.get(r[o]):this.#w,a=i.height-e[5],l=h.height+e[5];return a>=this.#M&&l>=this.#M&&(t.offChart.Divider.updateDividerPos(e),i.resize(void 0,a),h.resize(void 0,l)),i.element.style.userSelect="none",h.element.style.userSelect="none",{active:i,prev:h}}}class _{#r;#o;#t;#n;#e;#i;#s;#h;#a;#l;static menuList={};static menuCnt=0;static class=ne;static name="Menus";static type="menu";static currentActive;constructor(t,e){this.#o=t,this.#t=e.mediator,this.#n=this.#t.api.core,this.#e=e,this.#r=e.id,this.#s=t.elements.elMenus,this.#i=this.#n.elWidgetsG,this.init()}static create(t,e){const i=`menu${++_.menuCnt}`;return e.id=i,_.menuList[i]=new _(t,e),_.menuList[i]}static destroy(t){_.menuList[t].end(),delete _.menuList[t]}get el(){return this.#h}get id(){return this.#r}get pos(){return this.dimensions}get dimensions(){return u.elementDimPos(this.#h)}init(){this.mount(this.#s)}start(){this.position(this.#e.primary),this.eventsListen()}end(){const t=this.#t.api;u.findBySelectorAll(`#${t.id} .${re} li`).forEach(i=>{i.removeEventListener("click",this.onMenuSelect)}),document.removeEventListener("click",this.onOutsideClickListener)}eventsListen(){const t=this.#t.api;u.findBySelectorAll(`#${t.id} #${this.#e.id} li`).forEach(i=>{i.addEventListener("click",this.onMenuSelect.bind(this))}),document.addEventListener("click",this.onOutsideClickListener.bind(this))}on(t,e,i){this.#t.on(t,e,i)}off(t,e){this.#t.off(t,e)}emit(t,e){this.#t.emit(t,e)}onMenuSelect(t){let e=t.currentTarget.dataset.event,i={target:t.currentTarget.id,menu:this.#r,evt:e};this.emit(e,i),this.emit("menuItemSelected",i),this.emit("closeMenu",i)}onOutsideClickListener(t){if(!this.#h.contains(t.target)&&!this.#e.primary.contains(t.target)&&u.isVisible(this.#h)){let e={target:t.currentTarget.id,menu:this.#r};this.emit("closeMenu",e)}}mount(t){const e=this.#t.api;t.lastElementChild==null?t.innerHTML=this.menuNode():t.lastElementChild.insertAdjacentHTML("afterend",this.menuNode()),this.#h=u.findBySelector(`#${e.id} #${this.#e.id}`)}static defaultNode(){return`
      <div class="${ne}" style=""></div>
    `}menuNode(){const t=this.#e,e=`position: absolute; z-index: 1000; display: none; border: 1px solid ${Ot.COLOUR_BORDER}; background: ${Ot.COLOUR_BG}; color: ${Ot.COLOUR_TXT};`;let i=this.content(t);return`
      <div id="${t.id}" class="${re}" style="${e}">
        ${i}
      </div>
    `}content(t){this.#t.api;const e="list-style: none; text-align: left; margin:1em 1em 1em -2.5em;",i="padding: .25em 1em .25em 1em;",n="display: inline-block; width: 4em;",r="cursor: pointer;",o=`onmouseover="this.style.background ='#222'"`,h=`onmouseout="this.style.background ='none'"`;let a=`<ul style="${e}">`;if(t?.content)for(let l of t.content)a+=`<li id="${l.id}" data-event="${l.event}" style="${i} ${r}" ${o} ${h}><a style="${r}"><span style="${n}">${l.id}</span><span>${l.name}</span></li></a>`;return a+="</ul>",a}position(t){let e=this.#i.getBoundingClientRect(),i=t.getBoundingClientRect();this.#h.style.left=Math.round(i.left-e.left)+"px",this.#h.style.top=Math.round(i.bottom-e.top)+"px"}remove(){}open(){let t=_.currentActive?.id||!1;t&&this.emit("closeMenu",{menu:t}),_.currentActive=this,this.#h.style.display="block"}close(){_.currentActive=null,this.#h.style.display="none",this.emit("menuClosed",this.id)}}class E{#r;#o;#t;#n;#e;#i;#s;#h;#a;#l;static windowList={};static windowCnt=0;static class=he;static name="Windows";static type="window";static currentActive=null;constructor(t,e){this.#o=t,this.#t=e.mediator,this.#n=this.#t.api.core,this.#e=e,this.#r=e.id,this.#s=t.elements.elWindows,this.#i=this.#n.elWidgetsG,this.init()}static create(t,e){const i=`window${++E.windowCnt}`;return e.id=i,E.windowList[i]=new E(t,e),E.windowList[i]}static destroy(t){E.windowList[t].end(),delete E.windowList[t]}get el(){return this.#h}get id(){return this.#r}get pos(){return this.dimensions}get config(){return this.#e}set config(t){this.#e=t}get dimensions(){return u.elementDimPos(this.#h)}init(){this.mount(this.#s)}start(){this.eventsListen(),this.open()}end(){document.removeEventListener("click",this.onOutsideClickListener)}eventsListen(){this.#t.api,this.on("closeWindow",t=>{t.window===this.#r&&this.close()})}on(t,e,i){this.#t.on(t,e,i)}off(t,e){this.#t.off(t,e)}emit(t,e){this.#t.emit(t,e)}onOutsideClickListener(t){if(!this.#h.contains(t.target)&&u.isVisible(this.#h)){let e={target:t.currentTarget.id,window:this.#r};this.emit("closeWindow",e)}}mount(t){const e=this.#t.api;t.lastElementChild==null?t.innerHTML=this.windowNode():t.lastElementChild.insertAdjacentHTML("afterend",this.windowNode()),this.#h=u.findBySelector(`#${e.id} #${this.#e.id}`);let i,n;if(this.#e.x&&this.#e.y)i=this.#e.x,n=this.#e.y;else{let r=u.elementDimPos(this.#h);i=(this.#n.width-r.width)/2,n=(this.#n.height-r.height)/2}this.#h.style.bottom=`${n}px`,this.#h.style.left=`${i}px`}static defaultNode(){return`
      <div class="${he}" style=""></div>
    `}windowNode(){const t=this.#e,e=`position: absolute; z-index: 1000; display: block; border: 1px solid ${At.COLOUR_BORDER}; background: ${At.COLOUR_BG}; color: ${At.COLOUR_TXT};`;let i=this.dragBar(t),n=this.content(t),r=this.closeIcon(t);return`
      <div id="${t.id}" class="${Ye}" style="${e}">
          ${i}
          ${r}
          ${n}
        </div>
      </div>
    `}content(t){const e="padding: 2em;";let i=t?.content?t.content:"";return`
      <div class="content" style="${e}">
        ${i}
      </div>
    `}dragBar(t){this.#t.api;const e="cursor: grab;",i=`onmouseover="this.style.background ='#222'"`,n=`onmouseout="this.style.background ='none'"`,r=`${e}`;let o="";return t.dragBar&&(o+=`
      <div class="dragBar" ${r} ${i} ${n}>
      </div>
    `),o}closeIcon(t){this.#t.api;const e="cursor: pointer;",i=`onmouseover="this.style.background ='#222'"`,n=`onmouseout="this.style.background ='none'"`,r=`${e}`;let o="";return t.closeIcon&&(o+=`
      <div class="closeIcon" ${r} ${i} ${n}>
        <span>X</span>
      </div>
    `),o}position(t){let e=this.#i.getBoundingClientRect(),i=t.getBoundingClientRect();this.#h.style.left=Math.round(i.left-e.left)+"px",this.#h.style.top=Math.round(i.bottom-e.top)+"px"}remove(){}open(){E.currentActive=this,this.#h.style.display="block",this.emit("windowOpened",this.id),setTimeout(()=>{document.addEventListener("click",this.onOutsideClickListener.bind(this))},1e3)}close(){E.currentActive=null,this.#h.style.display="none",this.emit("windowClosed",this.id),document.removeEventListener("click",this.onOutsideClickListener)}}class rs extends E{static type="window";constructor(t,e){super(),e.dragbar=!0,e.close=tue,this.config=e}}class V{#r;#o;#t;#n;#e;#i;#s;#h;#a;#l;static dividerList={};static divideCnt=0;static class=oe;static name="Dividers";static type="divider";constructor(t,e){this.#o=t,this.#t=e.offChart,this.#n=e.mediator,this.#e=this.#n.api.core,this.#r=e.id,this.#i=t.elements.elDividers,this.#h=e.offChart.elOffChart,this.init()}static create(t,e){const i=`divider${++V.divideCnt}`;return e.id=i,V.dividerList[i]=new V(t,e),V.dividerList[i]}static destroy(t){V.dividerList[t].end(),delete V.dividerList[t]}get el(){return this.#s}get ID(){return this.#r}get offChart(){return this.#t}get config(){return this.#e.config}get pos(){return this.dimensions}get dimensions(){return u.elementDimPos(this.#s)}get height(){return this.#s.clientHeight}init(){this.mount()}start(){this.setCursor("n-resize"),this.eventsListen()}end(){this.#l.removeEventListener("mouseenter",this.onMouseEnter),this.#l.removeEventListener("mouseout",this.onMouseOut),this.#l.removeEventListener("drag",this.onDividerDrag),this.#l.removeEventListener("enddrag",this.onDividerDragDone),this.el.remove()}eventsListen(){this.#l=new j(this.#s),this.#l.on("mouseenter",this.onMouseEnter.bind(this)),this.#l.on("mouseout",this.onMouseOut.bind(this)),this.#l.on("drag",this.onDividerDrag.bind(this)),this.#l.on("enddrag",this.onDividerDragDone.bind(this)),this.#l.on("mousedown",this.onMouseDown.bind(this)),this.#l.on("mouseup",this.onMouseUp.bind(this))}on(t,e,i){this.#n.on(t,e,i)}off(t,e){this.#n.off(t,e)}emit(t,e){this.#n.emit(t,e)}onMouseEnter(){this.#s.style.background="#888888C0"}onMouseOut(){this.#s.style.background="#FFFFFF00"}onDividerDrag(t){this.#a=[Math.floor(t.position.x),Math.floor(t.position.y),t.dragstart.x,t.dragstart.y,t.movement.x,t.movement.y];const e={divider:this,cursorPos:this.#a};this.emit("divider_drag",e)}onDividerDragDone(t){this.#a=[Math.floor(t.position.x),Math.floor(t.position.y),t.dragstart.x,t.dragstart.y,t.movement.x,t.movement.y];const e={divider:this,cursorPos:this.#a};this.emit("divider_dragDone",e)}onMouseDown(t){this.#a=[Math.floor(t.position.x),Math.floor(t.position.y)],this.emit(`${this.ID}_mousedown`,this.#a),this.emit("divider_mousedown",{id:this.ID,e:t,pos:this.#a,offChart:this.offChart})}onMouseUp(t){this.#a=[Math.floor(t.position.x),Math.floor(t.position.y)],this.emit(`${this.ID}_mouseup`,this.#a),this.emit("divider_mouseup",{id:this.ID,e:t,pos:this.#a,offChart:this.offChart})}mount(){this.#i.lastElementChild==null?this.#i.innerHTML=this.dividerNode():this.#i.lastElementChild.insertAdjacentHTML("afterend",this.defaultNode()),this.#s=u.findBySelector(`#${this.#r}`)}setCursor(t){this.#s.style.cursor=t}static defaultNode(){return`
  <div class="${oe}" style="position: absolute;"></div>
  `}dividerNode(){let t=this.#t.pos.top-u.elementDimPos(this.#i).top,e=this.#e.MainPane.rowsW,i=y(this.config.dividerHeight)?this.config.dividerHeight:ci,n=this.#e.toolsW;t-=i/2;const r=`position: absolute; top: ${t}px; left: ${n}px; z-index:100; width: ${e}px; height: ${i}px; background: #FFFFFF00;`;return`
  <div id="${this.#r}" class="divider" style="${r}"></div>
  `}updateDividerPos(t){let e=this.#s.offsetTop;e+=t[5],this.#s.style.top=`${e}px`}setDividerPos(){let t=this.#t.pos.top-u.elementDimPos(this.#i).top;t=t-this.height/2,this.#s.style.top=`${t}px`}}var Re={id:"widgets",initial:"idle",context:{},states:{idle:{onEnter(s,t){console.log(`${s.id}: state: "${s.state}" - onEnter`)},onExit(s,t){console.log(`${s.id}: state: "${s.state}" - onExit (${s.event})`)},on:{openMenu:{target:"openMenu",action:(s,t)=>{console.log(`${s.id}: transition from "${s.state}" to "openMenu" on ${s.event}`)}}}},openMenu:{onEnter(s,t){console.log(`${s.id}: state: "${s.state}" - onEnter`)},onExit(s,t){console.log(`${s.id}: state: "${s.state}" - onExit (${s.event})`)},on:{closeMenu:{target:"idle",action:(s,t)=>{console.log(`${s.id}: transition from "${s.state}" to "idle" on "${s.event}"`)}}}},openWindow:{onEnter(s,t){console.log(`${s.id}: state: "${s.state}" - onEnter`)},onExit(s,t){console.log(`${s.id}: state: "${s.state}" - onExit (${s.event})`)},on:{closeWindow:{target:"idle",action:(s,t)=>{console.log(`${s.id}: transition from "${s.state}" to "idle" on "${s.event}"`)}}}}}};class os{#r="Widgets";#o="widgets";#t;#n;#e;#i;#s={Dialogue:rs,Divider:V,Menu:_,Window:E};#h={};#a={};#l;#d;#c;#f;#g;constructor(t,e){this.#t=t,this.#n=e,this.#i=e.widgets||this.#s,this.#l=this.#t.api.core.elWidgetsG,this.#e=this.#t.api.parent,this.init()}log(t){this.#t.log(t)}info(t){this.#t.info(t)}warning(t){this.#t.warn(t)}error(t){this.#t.error(t)}get name(){return this.#r}get shortName(){return this.#o}get mediator(){return this.#t}get options(){return this.#n}get elements(){return this.#a}get instances(){return this.#h}init(){this.mount(this.#l);const t=this.#t.api;t.parent=this.#t,t.elements={...t.elements,elWidgetsG:this.#l};for(let e in this.#i){let i=this.#i[e],n=`el${i.name}`;this.#a[n]=u.findBySelector(`#${t.id} .${i.class}`)}}start(){this.eventsListen(),Re.context.origin=this,this.#t.stateMachine=Re,this.#t.stateMachine.start()}end(){}eventsListen(){this.on("openMenu",this.onOpenMenu.bind(this)),this.on("closeMenu",this.onCloseMenu.bind(this)),this.on("offMenu",this.onCloseMenu.bind(this))}on(t,e,i){this.#t.on(t,e,i)}off(t,e){this.#t.off(t,e)}emit(t,e){this.#t.emit(t,e)}onResize(t){this.setDimensions(t)}onOpenMenu(t){console.log("onOpenMenu:",t),this.#h[t.menu].open()}onCloseMenu(t){console.log("onCloseMenu:",t),this.#h[t.menu].close()}mount(t){t.innerHTML=this.defaultNode()}setWidth(t){this.#f=t}setHeight(t){this.#g=t}setDimensions(t){this.setWidth(t.mainW),this.setHeight(t.mainH)}defaultNode(){let t="",e=[];for(let i in this.#i){let n=this.#i[i];e.indexOf(n.type)===-1&&(t+=n.defaultNode(),e.push(n.type))}return t}insert(t,e){e.mediator=this.mediator;const i=this.#i[t].create(this,e);return this.#h[i.id]=i,i}remove(t,e){delete this.#h[e],this.#i[t].destroy(e)}}class hs{#r;#o;#t;#n=[];constructor(t,e){this.#r=t,this.#o=S(e.id)?e.id:dt,this.#t=S(e.type)?e.type:"default",this.#n=F(e.data)?e.data:[]}}function as(s,t=!1){if(!F(s))return!1;let e=di(0,s.length);if(!Et(s[0],t)||!Et(s[e],t)||!Et(s[s.length-1],t))return!1;let i=s[0][0],n=s[1][0],r=s[2][0];return!(i>n&&n>r)}function ls(s,t=!1){if(!F(s))return!1;let e=0,i=0;for(;e<s.length;){if(!Et(s[e],t)||s[e][0]<i)return!1;i=s[e][0],e++}return!0}function Et(s,t=!1){return!(!F(s)||s.length!==6||t&&!Me(s[0])||!y(s[1])||!y(s[2])||!y(s[3])||!y(s[4])||!y(s[5]))}function cs(s,t=0,e=s.chart.length-1){let i=s;return i.dataLength=i.data.length-1,t>e&&([t,e]=[e,t]),e-t<k&&(e=t+k+1),t=t<wt*-1?wt*-1:t,e=e<wt*-1+k?wt*-1+k+1:e,t=t>i.dataLength+vt-k?i.dataLength+vt-k-1:t,e=e>i.dataLength+vt?i.dataLength+vt:e,i.value=n=>ds(i,n),i.interval=i.data[1][0]-i.data[0][0],i.intervalStr=Nt(i.interval),i.indexStart=t,i.indexEnd=e,i.Length=i.indexEnd-i.indexStart,i.timeStart=i.value(0)[0],i.timeFinish=i.value(i.dataLength)[0],i.timeDuration=i.timeFinish-i.timeStart,i.timeMin=i.value(i.indexStart)[0],i.timeMax=i.value(i.indexEnd)[0],i.rangeDuration=i.timeMax-i.timeMin,i={...i,...us(i.data,i.indexStart,i.indexEnd)},i.height=i.priceMax-i.priceMin,i.volumeHeight=i.volumeMax-i.volumeMin,i.scale=i.Length/(i.dataLength-1),i}function ds(s,t){let e=s.data[t];if(e!==void 0)return e;{const i=s.data.length-1;return e=[null,null,null,null,null,null],t<0?(e[0]=s.data[0][0]+s.interval*t,e):t>i?(e[0]=s.data[i][0]+s.interval*(t-i),e):null}}function us(s,t=0,e=s.length-1){let i=s.length-1,n=t<0?0:t;n=t>=s.length?i-k:n;let r=e<0?k:e;r=e>=i?i:r;let o=s[n][3],h=s[n][2],a=s[n][5],l=s[n][5];for(;n++<r;)o=s[n][3]<o?s[n][3]:o,h=s[n][2]>h?s[n][2]:h,a=s[n][5]<a?s[n][5]:a,l=s[n][5]>l?s[n][5]:l;return{priceMin:o*.995,priceMax:h*1.005,volumeMin:a,volumeMax:l}}function gs(s){let t=Math.min(s.length-1,99),e=1/0;return s.slice(0,t).forEach((i,n)=>{let r=s[n+1][0]-i[0];r===r&&r<e&&(e=r)}),e}const fs={chart:{type:"candles",candleType:"CANDLE_SOLID",indexed:!1,data:[],settings:{},row:{},tf:"",tfms:0},onchart:[],offchart:[],datasets:[],tools:[],ohlcv:[]};class bt{static#r=[];#o="";#t={};#n="";#e="";#i;#s={};#h;#a={};#l=!1;constructor(t,e=!1,i=!1){C(t)?(this.#t=this.validateState(t,e,i),this.#l="valid"):(this.defaultState(),this.#l="default")}static create(t,e=!1,i=!1){const n=new bt(t,e,i);return bt.#r.push(n),n}static delete(t){}get status(){return this.#l}get data(){return this.#t}validateState(t,e=!1,i=!1){"chart"in t||(t.chart={type:"Candles",candleType:"CANDLE_SOLID",data:t.ohlcv||[]}),e?t.chart.data=ls(t.chart.data,i)?t.chart.data:[]:t.chart.data=as(t.chart.data,i)?t.chart.data:[],(typeof t.chart?.tf!="number"||e)&&(t.chart.tfms=gs(t.chart.data)),(typeof t.chart?.tfms!="string"||e)&&(t.chart.tf=Nt(t.chart.tfms)),"onchart"in t||(t.onchart=[]),"offchart"in t||(t.offchart=[]),t.chart.settings||(t.chart.settings={}),delete t.ohlcv,"datasets"in t||(t.datasets=[]);for(var n of t.datasets)this.#a||(this.#a={}),this.dss[n.id]=new hs(this,n);return t}defaultState(){this.#t=fs}deepMerge(t,e){return Gt(t,e)}}const ms="overflow: hidden;",ps="border-bottom: 1px solid;",ys="position: relative;",vs="position: absolute; top: 0; left: 0; height: 100%; min-height: 100%; border-right: 1px solid;",ws="position: absolute; top: 0; height: 100%;";(async()=>await Ft.init("node_modules/talib-web/lib/talib.wasm"))();class K{static#r=0;static#o={};#t;#n=Pt;#e=Pt;#i=void 0;#s;#h;#a;#l={};#d;#c;#f;#g;#u;#p;#T;#y;#w=null;#S;#m={};#_=[];#E;#M;#v=Ht;#D=Wt;#L=Ft;#x;#b=500;#A=400;chartWMin=500;chartHMin=400;chartW_Reactive=!0;chartH_Reactive=!0;chartBGColour=Dt.COLOUR_BG;chartTxtColour=Dt.COLOUR_TXT;chartBorderColour=Dt.COLOUR_BORDER;utilsH=40;toolsW=45;timeH=50;scaleW=60;static permittedClassNames=["TradeXchart","Chart","MainPane","OffChart","OnChart","ScaleBar","Timeline","ToolsBar","UtilsBar","Widgets"];#$;#O;#C={chart:{},time:{}};#k;panes={utils:this.#$,tools:this.#O,main:this.#C};#P={rangeTotal:!0,range:{},total:{},timeFrameMS:0,timeFrame:"",timeZone:"",indexed:!1};logs=!1;info=!1;warnings=!1;errors=!1;#W={x:0,y:0};#I=0;#R=0;#H=[null,null,null,null];constructor(t,e={}){let i=e?.container,n=e?.state,r=e?.deepValidate||!1,o=e?.isCrypto||!1;S(i)&&(i[0]==="#"?i=u.findByID(i):i=u.findBySelector(i)),u.isElement(i)?(this.#i=i,this.#s=t,this.#m=bt.create(n,r,o),this.log(`Chart ${this.#t} created with a ${this.#m.status} state`),delete e.state,this.#P.timeFrame=this.#m.data.chart.tf,this.#P.timeFrameMS=this.#m.data.chart.tfms,this.init(e)):this.error(`${Pt} cannot be mounted. Provided element does not exist in DOM`)}log(t){this.#s.log(t)}info(t){this.#s.info(t)}warning(t){this.#s.warn(t)}error(t){this.#s.error(t)}get id(){return this.#t}get name(){return this.#n}get shortName(){return this.#e}get mediator(){return this.#s}get options(){return this.#a}get config(){return this.#h}get inCnt(){return this.#w}get width(){return this.#b}set width(t){this.setWidth(t)}get height(){return this.#A}set height(t){this.setHeight(t)}get elUtils(){return this.#c}get elTools(){return this.#g}get elMain(){return this.#u}get elWidgetsG(){return this.#y}get UtilsBar(){return this.#$}get ToolsBar(){return this.#O}get MainPane(){return this.#C}get Timeline(){return this.#C.time}get WidgetsG(){return this.#k}get Chart(){return this.#C.chart}get chartData(){return this.#m.data.chart.data}get offChart(){return this.#m.data.offchart}get onChart(){return this.#m.data.onchart}get datasets(){return this.#m.data.datasets}get rangeLimit(){return y(this.#v)?this.#v:Ht}get range(){return this.#M}get time(){return this.#P}get TimeUtils(){return _i}get theme(){return this.#x}get settings(){return this.#m.data.chart.settings}get indicators(){return this.#D}get TALib(){return this.#L}get candleW(){return this.Timeline.candleW}get buffer(){return this.MainPane.buffer}get bufferPx(){return this.MainPane.bufferPx}set scrollPos(t){this.setScrollPos(t)}get scrollPos(){return this.#I}get smoothScrollOffset(){return 0}get rangeScrollOffset(){return Math.floor(this.bufferPx/this.candleW)}get mousePos(){return this.#W}static create(t,e={},i){const n=++K.#r;e.modID=`${te}_${n}`,e.container=t;const r=new Ue.Core(e),o={permittedClassNames:K.permittedClassNames};e.state=i;const h=r.register(e.modID,K,e,o);return K.#o[n]=r,h}static destroy(t){if(t.constructor.name==="TradeXchart"){const e=t.inCnt;delete K.#o[e]}}init(t){this.#h=t,this.#w=t.cnt,this.#S=t.modID;const e=C(t)&&S(t.id)?t.id:null;if(this.setID(e),this.mount(),C(t))for(const o in t)o in this.props()&&this.props()[o](t[o]);const i=this.chartData.length-1,n=i-this.#v;this.setRange(n,i);const r={...this.#s.api,id:this.id,parent:this.#s,core:this,inCnt:this.inCnt,width:this.width,width:this.width,height:this.height,chartBGColour:this.chartBGColour,chartTxtColour:this.chartTxtColour,chartBorderColour:this.chartBorderColour,utilsH:this.utilsH,toolsW:this.toolsW,timeH:this.timeH,scaleW:this.scaleW,elements:this.#l,UtilsBar:this.UtilsBar,ToolsBar:this.ToolsBar,MainPane:this.MainPane,WidgetsG:this.WidgetsG,Chart:this.Chart,chartData:this.chartData,offChart:this.offChart,onChart:this.onChart,datasets:this.datasets,rangeLimit:this.rangeLimit,range:this.#M,updateRange:o=>this.updateRange(o),indicators:this.indicators,time:this.time,settings:this.settings};this.#k=this.#s.register("WidgetsG",os,t,r),this.#$=this.#s.register("UtilsBar",pi,t,r),this.#O=this.#s.register("ToolsBar",vi,t,r),this.#C=this.#s.register("MainPane",ns,t,r),r.Timeline=this.Timeline,r.Chart=this.Chart,this.log(`${this.#n} instantiated`)}start(){this.log("...processing state"),this.#I=this.bufferPx*-1,this.eventsListen(),this.UtilsBar.start(),this.ToolsBar.start(),this.MainPane.start(),this.WidgetsG.start()}end(){this.log("...cleanup the mess"),removeEventListener("mousemove",this.onMouseMove)}eventsListen(){this.#d.addEventListener("mousemove",this.onMouseMove.bind(this))}on(t,e,i){this.#s.on(t,e,i)}off(t,e){this.#s.off(t,e)}emit(t,e){this.#s.emit(t,e)}onMouseMove(t){this.#W.x=t.clientX,this.#W.y=t.clientY}mount(){this.#i.innerHTML=this.defaultNode(),this.#d=u.findBySelector(`#${this.id}`),this.#c=u.findBySelector(`#${this.id} .${ft}`),this.#f=u.findBySelector(`#${this.id} .${ee}`),this.#g=u.findBySelector(`#${this.id} .${mt}`),this.#u=u.findBySelector(`#${this.id} .${se}`),this.#p=u.findBySelector(`#${this.id} .${It}`),this.#T=u.findBySelector(`#${this.id} .${rt}`),this.#y=u.findBySelector(`#${this.id} .${ie}`),this.#l={elTXChart:this.#d,elUtils:this.#c,elBody:this.#f,elTools:this.#g,elMain:this.#u,elRows:this.#p,elTime:this.#T,elWidgetsG:this.#y}}unmount(){this.cleanup()}cleanup(){}props(){return{userClasses:t=>this.setUserClasses(t),width:t=>this.setWidth(t),height:t=>this.setHeight(t),logs:t=>this.logs=I(t)?t:!1,infos:t=>this.infos=I(t)?t:!1,warnings:t=>this.warnings=I(t)?t:!1,errors:t=>this.errors=I(t)?t:!1,rangeLimit:t=>this.#v=y(t)?t:Ht,indicators:t=>this.#D={...Wt,...t},theme:t=>this.setTheme(t)}}getInCnt(){return this.#w}setID(t){S(t)?this.#t=t+this.#w:this.#t=te+this.#w}getID(){return this.#t}getModID(){return this.#S}setWidth(t){y(t)?this.#b=t:this.#b=this.#i.parentElement.width,this.#d.style.width=`${this.#b}px`,this.#c.style.width=`${this.#b}px`,this.#f.style.width=`${this.#b}px`,this.#u.style.width=`${this.#b-this.toolsW}px`}setHeight(t){y(t)?this.#A=t:this.#A=this.#i.parentElement.clientHeight,this.#d.style.height=`${this.#A}px`,this.#f.style.height=`${this.#A-this.utilsH}px`,this.#u.style.height=`${this.#A-this.utilsH}px`}setDimensions(t,e){let i=this.width,n=this.height;this.setWidth(t),this.setHeight(e),this.emit("resize",{width:this.width,height:this.height,mainW:this.#C.width,mainH:this.#C.height,resizeW:t/i,resizeH:e/n,resizeWDiff:t-i,resizeHDiff:e-n})}setTheme(t){this.#x=t}setScrollPos(t){t=Math.round(t),y(t)&&t<=0&&t>=this.bufferPx*-1?this.#I=t:this.emit("Error","setScrollPos: not a valid value")}setUserClasses(t){if(S(t)){let e=t.split(" ");this.#_=e}else F(t)?this.#_=t:this.warn("Supplied user classes not valid. Expecting type String or Array");for(let e of this.#_)classes.add(e)}defaultNode(){const t=Ge+" "+this.#_,e=ms+` height: ${this.height}px; width: ${this.#b}px; background: ${this.chartBGColour}; color: ${this.chartTxtColour};`,i=ps+` height: ${this.utilsH}px; width: ${this.#b}px; border-color: ${this.chartBorderColour};`,n=ys+` height: calc(100% - ${this.utilsH}px); width: ${this.#b}px;`,r=vs+` width: ${this.toolsW}px; border-color: ${this.chartBorderColour};`,o=ws+` left: ${this.toolsW}px; width: calc(100% - ${this.toolsW}px);`,h=" position: relative;";return`
      <div id="${this.id}" class="${t}" style="${e}">
        <div class="${ft}" style="${i}"></div>
        <div class="${ee}" style="${n}">
          <div class="${mt}" style="${r}"></div>
          <div class="${se}" style="${o}">
          </div>
        </div>
        <div class="${ie}" style="${h}"></div>
      </div>
    `}setClasses(t){}updateRange(t){let e,i,n;i=0,e=t[4],n=this.#I+e,n<this.bufferPx*-1?(n=0,i=this.rangeScrollOffset*-1,this.offsetRange(i)):n>0&&(n=this.bufferPx*-1,i=this.rangeScrollOffset,this.offsetRange(i)),this.#I=n}offsetRange(t){let e=this.range.indexStart-t,i=this.range.indexEnd-t;this.setRange(e,i)}setRange(t,e){const i={data:this.chartData,onChart:this.onChart,offChart:this.offChart,datasets:this.datasets};this.#M=cs(i,t,e),this.#M.interval=this.#P.timeFrameMS,this.#M.intervalStr=this.#P.timeFrame,this.#P.range=this.#M}resize(t,e){return!y(t)&&!y(e)?!1:(this.setDimensions(t,e),!0)}notImplemented(){if(this.implemented)this.implemented.open();else{let e={content:`
        This feature is not implemented yet.
      `};this.implemented=this.#k.insert("Dialogue",e),this.implemented.start()}}}P.Chart=K,P.DOM=u,Object.defineProperties(P,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
